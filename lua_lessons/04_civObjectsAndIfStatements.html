<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/css/style.css">
  <!--<link rel="icon" type="image/png" href="/assets/civfanatics_icon.png">-->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        let z = document.body.getElementsByTagName("include")
        for (let i = 0; i < z.length; ++i) {
            let elmnt = z[i]
            let xhttp = new XMLHttpRequest()
            xhttp.onreadystatechange = function() { elmnt.innerHTML = this.responseText }
            xhttp.open("GET", elmnt.getAttribute("src"), true)
            xhttp.send()
        }
    })
</script>
</head>
<body><header class="site-header">
  <div class="wrapper">
    <!--img src="/assets/logo-cfc.png" class="center"--><a class="site-title" rel="author" href="/">Lua for Civilization II</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/auto_doc/autoIndex.html">Function Docs</a><a class="page-link" href="/executionPoints.html">Execution Points</a><a class="page-link" href="/lua_lessons/lessons_toc.html">Lua Lessons</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <head><title>Civ Objects and If Statements (Lesson 4)</title>
</head>
<article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>
  
  <div class="post-content">
    <table>
  <tbody>
    <tr>
      <td>Previous: <a href="03_valuesAndVariables.html">Values and Variables</a></td>
      <td>Next: <a href="">Tables and Loops</a></td>
    </tr>
  </tbody>
</table>
<h1 id="civilization-ii-objects-and-if-statements">
  
  
    Civilization II Objects and If Statements <a href="#civilization-ii-objects-and-if-statements"><span class="self-link">&#128279</span></a>
  
  
</h1>
    
<h2 id="introduction">
  
  
    Introduction <a href="#introduction"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>So far in these lessons, the only interaction we’ve had with the Civ II game is to show a couple text boxes.  In this lesson, we will introduce a number of new data types which are unique to the Test of Time Patch Project flavour of Lua.  These <em>object</em> data types will provide us with ways to get information about the active game state and rules, and to change those things.</p>

<p>In addition, we’ll also introduce two more data types standard to all versions of Lua, the <em>nil</em> and <em>boolean</em> data types.  We will also see how to use <em>if</em> statements to allow code to sometimes be ignored.</p>
<h2 id="a-scenario-with-the-lua-scenario-template">
  
  
    A Scenario with the Lua Scenario Template <a href="#a-scenario-with-the-lua-scenario-template"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>Download <a href="lesson_downloads/ClassicRome-lesson-4.zip">this “ClassicRome” scenario</a>, and extract it into your <strong>Scenario</strong> folder (or wherever you decide is convenient).  This scenario is a combination of files from a Test of Time conversion of the Rome scenario that came with the original Civilization II that I made, and a <a href="https://forums.civfanatics.com/threads/modified-scenarios-workshop.410838/page-48#post-16264049">conversion made by Dadias</a>.  To that, I have added the basic files of the Lua Scenario Template, and generated a couple of customized files using scripts.  For now, just accept that the scenario has been prepared for writing Lua events.</p>

<p>Open Visual Studio Code, and select the “Open Folder” file option.</p>

<p><img src="04_lesson_images/open-folder.png" alt="open folder" /></p>

<p>Select the <strong>ClassicRome</strong> scenario folder, and tell VS Code that you trust the authors if you are asked.  Double check to make sure that <strong>ClassicRome</strong> is the root folder, and not either a subfolder or your <strong>Scenario</strong> folder.</p>

<p>Have a look at the file explorer column.  All the files are listed here, even saved games like <strong>sc_b278.sav</strong> and <strong>ROME.SCN</strong> which you can’t change with VS Code.  There are six folders that contain even more files, mostly <strong>.lua</strong> files to provide functionality to the template.</p>

<p><img src="04_lesson_images/file-explorer-column.png" alt="file explorer column" /></p>
<h2 id="a-persistent-scenario-event">
  
  
    A Persistent Scenario Event <a href="#a-persistent-scenario-event"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>In the last lesson, we wrote a simple onTurn event, but we had to use the Load Script button in the Lua Console every time that we loaded a game.  Now, using the Template, we have the event load automatically with the game.  Open <strong>discreteEvents.lua</strong>, and scroll down to line 139, where you will find the following section of code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">---&amp;autoDoc onTurn</span>
<span class="n">discreteEvents</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span> 
    <span class="c1">--civ.ui.text("discrete on turn event 1")</span>
<span class="k">end</span><span class="p">)</span>
<span class="c1">---&amp;endAutoDoc</span>
</code></pre></div></div>
<p><img src="04_lesson_images/d-e-onTurn.png" alt="discreteEvents.onTurn" /></p>

<p>Don’t mind the comments.  <code class="language-plaintext highlighter-rouge">---&amp;autoDoc onTurn</code> and <code class="language-plaintext highlighter-rouge">---&amp;endAutoDoc</code> are annotations that I added for automatically building parts of this website, in this case the <a href="/executionPoints.html">Lua Execution Points</a> page.  You can delete them if you want.  Similarly, the commented out line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">--civ.ui.text("discrete on turn event 1")</span>
</code></pre></div></div>
<p>Is just there for me to uncomment when testing changes to the template.  It can be deleted, too.  In fact, everything within the “Discrete Events” section of this file is just example/testing code and can be removed if you don’t want it.  (The rest of the stuff is “setup” code that we’ll understand later.)</p>

<p>In the last lesson, we built an event that ran the following two lines of code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"It is now turn "</span><span class="o">..</span><span class="nb">tostring</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"This is a second message for turn "</span><span class="o">..</span><span class="n">turn</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
</code></pre></div></div>
<p>Copy these lines into the <code class="language-plaintext highlighter-rouge">discreteEvent.onTurn</code> registration starting at line 139.</p>

<p><img src="04_lesson_images/onTurn-simple.png" alt="onTurn messages" /></p>

<p>Save the file.  Note that although the Lua Language Server detects a couple of “mistakes” in this file, none of them are in our event.  Many files in the template will be coloured yellow, since (at the time of writing this) I haven’t gone through them all to re-document and suppress warnings.  (I wrote most of the Template before I discovered LuaLS.)</p>

<p>This scenario folder comes with a saved game to load, so start Test of Time and load the saved game <strong>sc_b278</strong> in the <strong>ClassicRome</strong> scenario folder.</p>

<p>Press CTRL+N to skip your turn, and see the two messages appear.</p>

<p>It can get a bit tedious to wait for the AI to move just to test onTurn events.  Fortunately, the Lua Scenario Template provides another way.  Open cheat mode, and bring up the console.  In the console, type the following command:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">console</span><span class="p">.</span><span class="n">onTurn</span><span class="p">()</span>
</code></pre></div></div>
<p>This will run the code registered for the onTurn event:</p>

<p><img src="04_lesson_images/console-onTurn.png" alt="console triggered onTurn" /></p>
<h2 id="the-tribeobject-and-nil-data-types">
  
  
    The tribeObject and nil Data Types <a href="#the-tribeobject-and-nil-data-types"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>Now, let’s do something a bit more interesting.  The current time to research a technology for the Romans is 80 turns, which seems like it could be a bit too much.  However, if we directly reduce the technology paradigm, that might make technology progress too quickly later in the scenario, or give advantage to large tribes over small ones.  Instead, we’re going to give each tribe one tenth of its total research cost each turn.</p>

<p>In order to do this, we’re going to have to use the <em>tribeObject</em> data type, which is a special data type for the Test of Time Patch Project version of Lua.  It represents certain characteristics of a Civilization in the current game, and we can use commands involving the <em>tribeObject</em> to get information about the tribe, or to change things about it.</p>

<p>Unlike numbers, strings, and functions, we can’t “construct” a tribeObject directly in code.  Instead, we will have to call a function, and get the tribeObject as a returned value.  The function <code class="language-plaintext highlighter-rouge">civ.getTribe</code> is how we will do that.  Here’s the <a href="/auto_doc/civ.html#gettribe">documentation</a>:</p>

<blockquote>
<h3 id="gettribe">
  
  
    getTribe <a href="#gettribe"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.getTribe(id: integer)
 -&gt; tribe: tribeObject|nil
</code></pre></div>  </div>
  <p>Returns the tribe with id <code class="language-plaintext highlighter-rouge">id</code> (0-7), or <code class="language-plaintext highlighter-rouge">nil</code> if it doesn’t exist.</p>
</blockquote>

<p>The parameter for <code class="language-plaintext highlighter-rouge">civ.getTribe</code> is the <code class="language-plaintext highlighter-rouge">id</code> of the tribe, which is an integer.  Each tribe has an <code class="language-plaintext highlighter-rouge">id</code> number associated with it, based on its position in the player order.  The barbarians play first, and they have an <code class="language-plaintext highlighter-rouge">id</code> of 0, then the Romans have an <code class="language-plaintext highlighter-rouge">id</code> of 1, and so on, until the Celts, who have an <code class="language-plaintext highlighter-rouge">id</code> of 7.  Next, consider this line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  -&gt; tribe: tribeObject|nil
</code></pre></div></div>
<p>This tells us what the return value of the function is.  <code class="language-plaintext highlighter-rouge">tribe</code> is just a label, like the parameter names.  It gives the programmer information, but Lua itself doesn’t care.  Often, documentation will omit a label for the return value.  The <code class="language-plaintext highlighter-rouge">|</code> character represents “or”, so the line is telling us that this function will return either a <em>tribeObject</em> or a <em>nil</em>.</p>

<p>The <em>nil</em> data type is a special data type, with one possible value: <code class="language-plaintext highlighter-rouge">nil</code>.  It is typically used to represent an absence of data, or “nothing,” rather than data itself.  The function <code class="language-plaintext highlighter-rouge">civ.getTribe(id)</code> returns <code class="language-plaintext highlighter-rouge">nil</code> when the <code class="language-plaintext highlighter-rouge">id</code> argument doesn’t correspond to an actual tribe.  This is a typical use of the <em>nil</em> data type.</p>

<p>Returning to the <em>tribeObject</em> data type, each <em>tribeObject</em> has certain “fields” that we can access (and sometimes change) using the corresponding “key” and a <code class="language-plaintext highlighter-rouge">.</code> to join it to the variable holding the <em>tribeObject</em>:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myTribeObject</span><span class="p">.</span><span class="n">someKey</span>
</code></pre></div></div>
<p>Before writing code in <strong>discreteEvents.lua</strong> or some other script, let’s play around a bit with the <em>tribeObject</em> in the Lua Console.  First, note that the console tells us that</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Global variables are disabled
</code></pre></div></div>
<p>The reason (as I’ve written a fair few times already in these lessons) for this will be explained in the lesson on <a href="lessonLinkPlaceHolde.html">variable scope</a>.  For now, we need to re-enable them, because local variables don’t work in the console.  I’ve included a command in the Lua Scenario Template to do this, but I don’t expect you to memorize the commands one by one as I tell them to you.  Instead, you only need to know one command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>console.commands()
</code></pre></div></div>
<p><img src="04_lesson_images/consoleCommands.png" alt="console commands" /></p>

<p>These are commands (or parts of commands, as we’ll see later) that can be used from the console.  In your own projects, you may find that I’ve removed some of these commands, or added new ones.  The Template still has work to be done, some important, some just polish.  For now, the relevant command for us is <code class="language-plaintext highlighter-rouge">console.restoreGlobal</code>.  Call that (with <code class="language-plaintext highlighter-rouge">()</code>) in the console:</p>

<p><img src="04_lesson_images/global-restored.png" alt="global variables restored" /></p>

<p>Now, let’s assign the <em>tribeObject</em> corresponding to the Romans into the variable <code class="language-plaintext highlighter-rouge">romans</code>:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">romans</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p>Now, let’s <code class="language-plaintext highlighter-rouge">print(romans)</code> and see what we get:</p>

<p><img src="04_lesson_images/print-romans.png" alt="print(romans)" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tribe&lt;id=1, name="Romans", leader="Scipio", money=250, cities=6, units=25, techs=20&gt;
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">Tribe&lt;&gt;</code> indicates that the item we’re printing a representation of is a <em>tribeObject</em>.  The items within the <code class="language-plaintext highlighter-rouge">&lt;&gt;</code> and separated by commas give us information about the fields in the <em>tribeObject</em>.  Most of these are direct key-value pairs for certain fields, but not all.  The <code class="language-plaintext highlighter-rouge">leader</code> field of a <em>tribeObject</em> is actually another Civ II data type: the <em>leaderObject</em>.</p>

<p>For now, type the following commands in the console to see some values for the Roman tribe:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">romans</span><span class="p">.</span><span class="n">id</span>
<span class="n">romans</span><span class="p">.</span><span class="n">name</span>
<span class="n">romans</span><span class="p">.</span><span class="n">adjective</span>
<span class="n">romans</span><span class="p">.</span><span class="n">researchCost</span>
<span class="n">romans</span><span class="p">.</span><span class="n">researchProgress</span>
</code></pre></div></div>

<p><img src="04_lesson_images/roman-fields.png" alt="roman fields" /></p>

<p>Here is the <a href="/auto_doc/tribeObject.html">full list of <em>tribeObject</em> fields</a>.  Let’s look at the documentation of a few fields:</p>

<blockquote>
<h3 id="id">
  
  
    id <a href="#id"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.id --&gt; integer
</code></pre></div>  </div>
  <p>(get) Returns the id of the tribe.</p>
</blockquote>

<p>The <code class="language-plaintext highlighter-rouge">tribeObject.id --&gt; integer</code> means that the <code class="language-plaintext highlighter-rouge">id</code> field of the <em>tribeObject</em> has an <em>integer</em> value.</p>

<p>The <code class="language-plaintext highlighter-rouge">(get)</code> means that you can get the value of the <code class="language-plaintext highlighter-rouge">id</code>, but it can’t be changed.</p>

<blockquote>
<h3 id="name">
  
  
    name <a href="#name"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.name --&gt; string
</code></pre></div>  </div>
  <p>(get/set) Returns the name of the tribe (e.g. “Romans”).</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">tribeObject.name --&gt; string</code> means that the value of the <code class="language-plaintext highlighter-rouge">name</code> field of a <em>tribeObject</em> is a <em>string</em>.</p>

<p>The <code class="language-plaintext highlighter-rouge">(get/set)</code> means that you can get the value of the <code class="language-plaintext highlighter-rouge">name</code>, but you can also assign a new value to it (“set” it).</p>

<blockquote>
<h3 id="adjective">
  
  
    adjective <a href="#adjective"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.adjective --&gt; string
</code></pre></div>  </div>
  <p>(get/set) Returns the adjectival form of the tribe’s name (e.g. “Roman”).</p>
</blockquote>

<p>Like the <code class="language-plaintext highlighter-rouge">name</code> field, the value of this field is a string, and the value can be changed.</p>

<blockquote>
<h3 id="researchcost">
  
  
    researchCost <a href="#researchcost"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.researchCost --&gt; integer
</code></pre></div>  </div>
  <p>(get) Returns the research cost of the tribe.</p>
</blockquote>

<p>Like the <code class="language-plaintext highlighter-rouge">id</code> field, the value of this field is an integer, and the field can not be assigned a new value (it is calculated from other game mechanics).</p>

<blockquote>
<h3 id="researchprogress">
  
  
    researchProgress <a href="#researchprogress"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.researchProgress --&gt; integer
</code></pre></div>  </div>
  <p>(get/set) Returns the progress towards the current research (range between 0 and tribe.researchCost).</p>
</blockquote>

<p>Like the <code class="language-plaintext highlighter-rouge">researchCost</code> field, the value of this field is an integer.  However, since it is a <code class="language-plaintext highlighter-rouge">(get/set)</code> field, we can assign a new value to it, and we shall do so now.</p>

<p>The syntax to assign a new value to a <em>tribeObject</em>’s field (or a field of any other TOTPP provided object) has this form:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myTribeObject</span><span class="p">.</span><span class="n">fieldKey</span> <span class="o">=</span> <span class="n">newValue</span>
</code></pre></div></div>
<p>So, using the console, we can change the name of the romans to, say, Etruscans.  Similarly, we can change the adjective to Etruscan.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">romans</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Etruscans"</span>
<span class="n">romans</span><span class="p">.</span><span class="n">adjective</span> <span class="o">=</span> <span class="s2">"Etruscan"</span>
</code></pre></div></div>

<p>If we look at the Science Advisor, we find that our tribe is now the Kingdom of the Etruscans:</p>

<p><img src="04_lesson_images/etruscan-science-advisor.png" alt="etruscan science advisor" /></p>

<p>Now, we will go back to the console, and change the research progress.  Thus far, we have used a previously assigned variable as the starting point for our field keys.  However, we could just use <code class="language-plaintext highlighter-rouge">civ.getTribe</code> directly, like this:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">researchProgress</span> <span class="o">=</span> <span class="mi">600</span>
</code></pre></div></div>
<p>Opening the Science Advisor again, we see that extra beakers have been added to the beaker box:</p>

<p><img src="04_lesson_images/more-science.png" alt="more science this time" /></p>

<p>Now, let us get back to our event to give each tribe one tenth of their research cost each turn.</p>

<p>We first need to choose a suitable <a href="/executionPoints.html">“execution point”</a> for our event.  Execution point is a term I use for a place where the game checks if there is Lua code registered to be executed, and, if there is, runs the code before continuing with the game.  This particular event has several reasonable execution points, but I’ve chosen to use <a href="/executionPoints.html#city-processing-complete">onCityProcessingComplete</a>.</p>

<p>There is already an example snippet of code for this execution point in <strong>discreteEvents.lua</strong>, but instead of giving you the line number, I’ll introduce VS Code’s search feature.  Press the search icon <img src="04_lesson_images/search-icon.png" alt="search icon" /> on the left, and that will bring up the search bar.  Type in</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>discreteEvents.onCityProcessingComplete
</code></pre></div></div>
<p>It will help to widen the search tab.  You will get 8 results in 3 files:</p>

<p><img src="04_lesson_images/search-example.png" alt="search example" /></p>

<p>We’re looking for a result in <strong>discreteEvents.lua</strong>, and there are two, highlighted in orange.  Click on the first result.</p>

<p><img src="04_lesson_images/first-instance.png" alt="first result" /></p>

<p>You will be brought here:</p>

<p><img src="04_lesson_images/search-result.png" alt="search result" /></p>

<p>With the result we clicked on in a lighter shade of orange than the other result, which is also highlighted.  Click on the file explorer icon to close the search.</p>

<p>If we hover the cursor over <code class="language-plaintext highlighter-rouge">onCityProcessingComplete</code>, we get some documentation about the function:</p>

<p><img src="04_lesson_images/cityProcessingComplete-info.png" alt="onCityProcessingComplete doc" /></p>

<p>Here, the documentation tells us that the registered function must have two parameters: <code class="language-plaintext highlighter-rouge">turn</code>, which must accept <em>integer</em> arguments, and <code class="language-plaintext highlighter-rouge">tribe</code>, which must accept <em>tribeObject</em> arguments.  Although the documentation doesn’t explicitly tell us this, it is pretty clear that the <code class="language-plaintext highlighter-rouge">turn</code> is an integer giving the current turn number, and <code class="language-plaintext highlighter-rouge">tribe</code> is the tribe that has just finished processing its cities.</p>

<p>First, we can delete the following testing code from our function:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">_global</span><span class="p">.</span><span class="n">eventTesting</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"discreteEvents.onCityProcessingComplete for "</span><span class="o">..</span><span class="n">tribe</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" on turn "</span><span class="o">..</span><span class="nb">tostring</span><span class="p">(</span><span class="n">turn</span><span class="p">))</span>
    <span class="k">end</span>
</code></pre></div></div>

<p>Since the <code class="language-plaintext highlighter-rouge">tribe</code> function argument is already a <em>tribeObject</em>, we don’t need to use <code class="language-plaintext highlighter-rouge">civ.getTribe</code> to access the <em>tribeObject</em> that we need.  Instead, we can move directly to changing the <code class="language-plaintext highlighter-rouge">researchProgress</code> field:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityProcessingComplete</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">,</span><span class="n">tribe</span><span class="p">)</span> 
    <span class="n">tribe</span><span class="p">.</span><span class="n">researchProgress</span> <span class="o">=</span> <span class="n">tribe</span><span class="p">.</span><span class="n">researchProgress</span> <span class="o">+</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">tribe</span><span class="p">.</span><span class="n">researchCost</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s understand this calculation:</p>

<ol>
  <li>We must start with the existing amount of accumulated research, so the right hand side must have <code class="language-plaintext highlighter-rouge">tribe.researchProgress</code>.</li>
  <li>Since we want to give a free 1/10 of research costs each turn, that must be computed, so we must have <code class="language-plaintext highlighter-rouge">tribe.researchCost/10</code>.</li>
  <li>We must assign an <em>integer</em> to <code class="language-plaintext highlighter-rouge">tribe.researchProgress</code>, but division by 10 is not guaranteed to have an integer result.  Therefore, we rely on the standard Lua function <code class="language-plaintext highlighter-rouge">math.floor</code> to round down <code class="language-plaintext highlighter-rouge">tribe.researchCosts/10</code> to the nearest integer.</li>
  <li>The final step of the calculation is to add the existing value to the new increment.</li>
</ol>

<p>Save this new event, and load a saved game.  The science advisor is at about half (unless you saved after making the earlier changes).  We can test this event with the console command <code class="language-plaintext highlighter-rouge">console.onCityProcessingComplete()</code>.  You should see an increased number of beakers.  However, it might not be easily noticeable.  But instead of taking and comparing pictures, we can just change the divisor from 10 to 2. After all, if our code will work when dividing by 2, we’d expect it to work dividing by 10 as well.</p>

<p>So, make the change, save the game, and test the event, both by using <code class="language-plaintext highlighter-rouge">console.onCityProcessingComplete()</code> and by letting the game go through another turn.  Note that the Science Advisor can’t show beyond 100% beakers, so you may have to save and load between tests to see a noticeable difference because the previous research progress was a bit less than half way done.</p>

<p>Remember to change your 2 back to 10!</p>
<h2 id="the-boolean-data-type">
  
  
    The Boolean Data Type <a href="#the-boolean-data-type"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>It frequently comes up in programming that we find it convenient to use a data type with only two possible values: <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.  This data type is called the <em>boolean</em> data type, sometimes shortened to “bool.”  The term “Boolean” gets its name from <a href="https://en.wikipedia.org/wiki/Boolean_algebra">George Boole</a>, a mathematician who studied logic where true and false (or 0 and 1) were the only possible values.</p>

<p>Let’s have a look at the <em>tribeObject</em> again.  One of the fields has a boolean value:</p>

<blockquote>
<h3 id="ishuman">
  
  
    isHuman <a href="#ishuman"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.isHuman --&gt; boolean
</code></pre></div>  </div>
  <p>(get/set) Returns whether the tribe is a/the human player.</p>
</blockquote>

<p>The value of this field is <code class="language-plaintext highlighter-rouge">true</code> when the tribe is controlled by a human player, and <code class="language-plaintext highlighter-rouge">false</code> when the tribe is controlled by the AI.</p>

<p>There are also a lot of functions that return booleans.  One example is <a href="/auto_doc/civ.html#istribe">civ.isTribe</a>:</p>

<blockquote>
<h3 id="istribe">
  
  
    isTribe <a href="#istribe"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.isTribe(object: any)
   -&gt; boolean
</code></pre></div>  </div>
  <p>Returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">object</code> is a tribe, <code class="language-plaintext highlighter-rouge">false</code> otherwise.</p>
</blockquote>

<p>This function accepts any kind of object, and returns a <em>boolean</em>.  It returns <code class="language-plaintext highlighter-rouge">true</code> if the object is a <em>tribeObject</em> and <code class="language-plaintext highlighter-rouge">false</code> otherwise.</p>
<h2 id="if-statements">
  
  
    If Statements <a href="#if-statements"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>So, we can now tell if an unknown object is a <em>tribeObject</em> or if a <em>tribeObject</em> is controlled by a human player.  But what good does it do us?  Until now, all the programs we’ve written have always executed the same code.  However, we don’t always have to execute the same instructions each time.  We can use an <em>if statement</em> to execute code only if some value is true.  The syntax for <em>if statements</em> take this form:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- code here is always executed</span>
<span class="k">if</span> <span class="n">value</span> <span class="k">then</span>
    <span class="c1">-- Execute code here only if the value is true</span>
<span class="k">end</span>
<span class="c1">-- code here is always executed</span>
</code></pre></div></div>
<p>That is, when the Lua Interpreter is executing code, and it arrives at an <code class="language-plaintext highlighter-rouge">if</code>, Lua will determine if the value between <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">then</code> is <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.  If the <code class="language-plaintext highlighter-rouge">value</code> is <code class="language-plaintext highlighter-rouge">true</code>, the code between <code class="language-plaintext highlighter-rouge">then</code> and <code class="language-plaintext highlighter-rouge">end</code> is executed.  If the <code class="language-plaintext highlighter-rouge">value</code> is <code class="language-plaintext highlighter-rouge">false</code>, the Lua Interpreter ignores everything until the corresponding <code class="language-plaintext highlighter-rouge">end</code> is reached, at which point it continues executing code.  If <code class="language-plaintext highlighter-rouge">value</code> is something more complicated than a simple variable, the expression will be evaluated to determine if it is <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.</p>

<p>Let’s have a look at a simple event with an <em>if statement</em>:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityProcessingComplete</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">turn</span><span class="p">,</span> <span class="n">tribe</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tribe</span><span class="p">.</span><span class="n">isHuman</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">leaderName</span> <span class="o">=</span> <span class="n">tribe</span><span class="p">.</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">leaderName</span><span class="o">..</span><span class="s2">"!  The "</span><span class="o">..</span><span class="n">tribe</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" Empire awaits your orders."</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>This is another event which takes place after all city production is done for the turn, and the tribe is just about ready to start moving units.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">tribe</span><span class="p">.</span><span class="n">isHuman</span> <span class="k">then</span>
</code></pre></div></div>
<p>This line gets the value registered in the <code class="language-plaintext highlighter-rouge">isHuman</code> field for the currently active tribe.  If it is <code class="language-plaintext highlighter-rouge">false</code>, the code between <code class="language-plaintext highlighter-rouge">then</code> and <code class="language-plaintext highlighter-rouge">end</code> is skipped, which, in this case, brings the Lua interpreter to the end of the function.</p>

<p>If <code class="language-plaintext highlighter-rouge">tribe.isHuman</code> is <code class="language-plaintext highlighter-rouge">true</code>, we progress to the next line:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="kd">local</span> <span class="n">leaderName</span> <span class="o">=</span> <span class="n">tribe</span><span class="p">.</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></div>
<p>On the right hand side, we begin by evaluating <code class="language-plaintext highlighter-rouge">tribe.leader</code>.</p>

<blockquote>
<h3 id="leader">
  
  
    leader <a href="#leader"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.leader --&gt; leaderObject
</code></pre></div>  </div>
  <p>(get) Returns the leader of the tribe.</p>
</blockquote>

<p>This field references a <a href="/auto_doc/leaderObject.html"><em>leaderObject</em></a>, which is a data type that contains information about a tribe’s leader.  Relevant to us is the name field:</p>

<blockquote>
<h3 id="name-1">
  
  
    name <a href="#name-1"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>leaderObject.name --&gt; string
</code></pre></div>  </div>
  <p>(get/set) Returns the name of the leader.</p>
</blockquote>

<p>So, if we call the result of <code class="language-plaintext highlighter-rouge">tribe.leader</code> <code class="language-plaintext highlighter-rouge">leaderOfTribe</code>, then our next step is to evaluate <code class="language-plaintext highlighter-rouge">leaderOfTribe.name</code>, which gives us a string corresponding to the leader’s name.  Therefore, the <code class="language-plaintext highlighter-rouge">leaderName</code> is assigned a string value, which is the tribe leader’s name.</p>

<p>Next, we evaluate</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">leaderName</span><span class="o">..</span><span class="s2">"!  The "</span><span class="o">..</span><span class="n">tribe</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" Empire awaits your orders."</span><span class="p">)</span>
</code></pre></div></div>
<p>This is stuff we’ve seen before.  It is joining several strings together to form a message, and then displaying it.</p>

<p>After this, the <code class="language-plaintext highlighter-rouge">end</code> of the <em>if statement</em> is reached, and, subsequently, the end of the entire function.</p>

<p>Add this code to <strong>discreteEvents.lua</strong>, save the file, re-load your civ game, and test it out.</p>

<p><img src="04_lesson_images/leader-message.png" alt="leader message" /></p>

<p><img src="04_lesson_images/leader-message-displayed.png" alt="leader message displayed" /></p>
<h2 id="if-else-statements">
  
  
    If-Else Statements <a href="#if-else-statements"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>In our last example, we checked if <code class="language-plaintext highlighter-rouge">tribe.isHuman</code> was <code class="language-plaintext highlighter-rouge">true</code>, and did something if it was.  If <code class="language-plaintext highlighter-rouge">tribe.isHuman</code> was <code class="language-plaintext highlighter-rouge">false</code>, nothing was done.  However, we will often want to do one thing if a value is <code class="language-plaintext highlighter-rouge">true</code> and something else if it is <code class="language-plaintext highlighter-rouge">false</code>.  The <em>if-else statement</em> provides a simple way to do that.  Here’s the syntax:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">value</span> <span class="k">then</span>
    <span class="c1">-- execute code here if the value is true</span>
    <span class="c1">-- do not execute if the value is false</span>
<span class="k">else</span>
    <span class="c1">-- execute code here if the value is false</span>
    <span class="c1">-- do not execute if the value is true</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Let’s see this syntax in another example.  We’ll add a little bit of flavour to the scenario by changing the name of the leader of the Romans every turn, to reflect the alternating nature of the consulship.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="c1">-- turn is even</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
    <span class="k">else</span>
        <span class="c1">-- turn is odd</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Fabius"</span>
    <span class="k">end</span>    
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>Let’s go through this event:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
</code></pre></div></div>
<p>This is an <code class="language-plaintext highlighter-rouge">onTurn</code> event (so it takes place after the Celts move and before the Barbarians move), and the <code class="language-plaintext highlighter-rouge">turn</code> parameter will be the number of the turn that is starting.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
</code></pre></div></div>
<p>This line introduces two new operators, <code class="language-plaintext highlighter-rouge">%</code> and <code class="language-plaintext highlighter-rouge">==</code>.  <code class="language-plaintext highlighter-rouge">turn % 2</code> is evaluated first, so let’s start with <code class="language-plaintext highlighter-rouge">%</code>, the “<a href="https://en.wikipedia.org/wiki/Modulo">modulo operator</a>.”  The modulo operator gets the remainder of a division.  Usually, when we divide one number by another, we don’t get an even split.  For example <include src="/_MqyOYAnrWb@S4LTBF8NtED.xml"></include>.  This is what makes sense in most contexts.  However, another way to describe the division is <include src="/_gQG3rn$uDaqz7YZVsomwIi.xml"></include> with remainder <include src="/_0uvVEyplMQXkK2O9dn7sA6.xml"></include>.  That is, we can make 2 groups of 4 out of 11, but we still have 3 left over.  This <code class="language-plaintext highlighter-rouge">%</code> operator extracts that 3 for us in this example.  So, <code class="language-plaintext highlighter-rouge">11 % 4</code> evaluates as <code class="language-plaintext highlighter-rouge">3</code> because 3 is the left over remainder when dividing 11 by 4.</p>

<p>In the case of <code class="language-plaintext highlighter-rouge">turn % 2</code>, the result can either be <code class="language-plaintext highlighter-rouge">0</code> (<code class="language-plaintext highlighter-rouge">turn</code> is an even integer, so there is 0 left over when dividing by 2) or <code class="language-plaintext highlighter-rouge">1</code> (<code class="language-plaintext highlighter-rouge">turn</code> is an odd integer, so there is 1 left over when dividing by 2).</p>

<p>The <code class="language-plaintext highlighter-rouge">==</code> operator checks if the values to either side are equal.  If they are, the result is <code class="language-plaintext highlighter-rouge">true</code>, otherwise, the result is <code class="language-plaintext highlighter-rouge">false</code>.  So, if <code class="language-plaintext highlighter-rouge">turn</code> is an even integer, then <code class="language-plaintext highlighter-rouge">turn % 2</code> evaluates to <code class="language-plaintext highlighter-rouge">0</code>, and then <code class="language-plaintext highlighter-rouge">0 == 0</code> evaluates to <code class="language-plaintext highlighter-rouge">true</code>.  If we go through each step of evaluating the line, if the <code class="language-plaintext highlighter-rouge">turn</code> is even, we get</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- suppose turn = 4</span>
    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">4</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="kc">true</span> <span class="k">then</span>
</code></pre></div></div>
<p>If <code class="language-plaintext highlighter-rouge">turn</code> is an odd number, then</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- suppose turn = 5</span>
    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">5</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="kc">false</span> <span class="k">then</span>
</code></pre></div></div>
<p>Our next line of code (plus the comment above it) is:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">-- turn is even</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
</code></pre></div></div>
<p>This code is run if the turn is even.  This is the first time we’ve had to evaluate the left hand side of an <code class="language-plaintext highlighter-rouge">=</code> sign assignment.  We can do this when we are assigning a value to a field.  The evaluation is as follows:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
    <span class="n">romanTribeObject</span><span class="p">.</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
    <span class="n">romanTribeLeader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
</code></pre></div></div>
<p>So, if <code class="language-plaintext highlighter-rouge">turn % 2 == 0</code> we change the name of the Roman Leader to Scipio, and ignore everything between <code class="language-plaintext highlighter-rouge">else</code> and <code class="language-plaintext highlighter-rouge">end</code>.  Otherwise, we skip this line of code and process this line instead:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">-- turn is odd</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Fabius"</span>
</code></pre></div></div>
<p>The evaluation is exactly the same as above, except that the leader name is set to <code class="language-plaintext highlighter-rouge">"Fabius"</code> instead.</p>

<p>Here’s the code typed into VS Code in <strong>discreteEvents.lua</strong></p>

<p><img src="04_lesson_images/scipio-fabius-event.png" alt="Scipio and Fabius Swap" /></p>

<p>Save the file, load your game again, and test this new event.  Not only will you receive different messages from our previous event, when you check reports like the Science Advisor, the name of the Roman leader will be different.</p>

<p><img src="04_lesson_images/fabius-text-box.png" alt="fabius leader message" /></p>

<p><img src="04_lesson_images/fabius-defense-minister.png" alt="fabius defense minister" /></p>

<p><img src="04_lesson_images/scipio-text-box.png" alt="scipio leader message" /></p>

<p><img src="04_lesson_images/scipio-trade-advisor.png" alt="scipio trade minister" /></p>
<h2 id="the-and--or-operators">
  
  
    The <code class="language-plaintext highlighter-rouge">and</code> &amp; <code class="language-plaintext highlighter-rouge">or</code> Operators <a href="#the-and--or-operators"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>It often happens that we want to write an if statement that is more complicated than a single <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code> evaluation.  We can use the <code class="language-plaintext highlighter-rouge">and</code> and <code class="language-plaintext highlighter-rouge">or</code> operators to combine several boolean values into a single result.</p>

<p>Let’s write an event to show a message when the Romans capture all of Sicily, that is, when they own both Lilybaeum and Syracuse.  To do this, I should first introduce two more TOTPP data types: the <em>tileObject</em> and the <em>cityObject</em>.</p>

<p>The <a href="/auto_doc/tileObject.html"><em>tileObject</em></a> represents a single tile on the map.  It keeps information like the current state of tile improvements, as well as whether there is a tribe that has units defending the tile.  The function <a href="/auto_doc/civ.html#getTile"><code class="language-plaintext highlighter-rouge">civ.getTile(x,y,z)</code></a> can be used to get a <em>tileObject</em> from its coordinates.  For our purposes now, we’re interested in one particular field of the <em>tileObject</em>:</p>

<blockquote>
<h3 id="city">
  
  
    city <a href="#city"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tileObject.city --&gt; cityObject|nil
</code></pre></div>  </div>
  <p>(get) Returns the city at the tile’s location, or <code class="language-plaintext highlighter-rouge">nil</code> if there’s no city there.</p>
</blockquote>

<p>We will use the <code class="language-plaintext highlighter-rouge">city</code> field of specific <em>tileObjects</em> in order to get <em>cityObjects</em> for the cities of Lilybaeum and Syracuse.  A <em>cityObject</em> has fields for characteristics such as city size, the current production order, and accumulated shields.  What we need for now, however, is the <code class="language-plaintext highlighter-rouge">owner</code> field:</p>

<blockquote>
<h3 id="owner">
  
  
    owner <a href="#owner"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cityObject.owner --&gt; tribeObject
</code></pre></div>  </div>
  <p>(get/set) Returns the city’s owner.</p>
</blockquote>

<p>Find the sample code for <code class="language-plaintext highlighter-rouge">discreteEvents.onCityTaken</code> in <strong>discreteEvents.lua</strong>.  You may wish to practice with the search feature again.  Since the example code is there, we might as well do something with it.</p>

<p><img src="04_lesson_images/sample-onCityTaken.png" alt="onCityTaken sample discrete event" /></p>

<p>We’ll begin by storing the <em>cityObjects</em> corresponding to Lilybaeum and Syracuse in appropriately named variables.  While we’re at it, we will give a name to the Romans tribe object:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">lilybaeum</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span>
<span class="kd">local</span> <span class="n">syracuse</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span>
<span class="kd">local</span> <span class="n">romans</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p>It is easy to get the coordinates of a city from the game.  That allows us to get the <em>tileObject</em> of the tile the city is on, and from there, we reference the <code class="language-plaintext highlighter-rouge">city</code> field to get the relevant <em>cityObject</em>.  By assigning these city and tribe objects to well named variables, the rest of our code will be more readable.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="n">defender</span><span class="p">)</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">city</span> <span class="o">==</span> <span class="n">lilybaeum</span> <span class="ow">or</span> <span class="n">city</span> <span class="o">==</span> <span class="n">syracuse</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">syracuse</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="ow">and</span> 
        <span class="n">lilybaeum</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have captured "</span><span class="o">..</span><span class="n">city</span><span class="p">.</span><span class="n">name</span><span class="o">..</span>
        <span class="s2">" from the "</span><span class="o">..</span><span class="n">defender</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" and, in so doing, have "</span><span class="o">..</span>
        <span class="s2">"completed their conquest of the island of Sicily."</span><span class="p">)</span>
    <span class="k">end</span>        
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>Let’s begin with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="n">defender</span><span class="p">)</span> 
</code></pre></div></div>
<p>From the <a href="/executionPoints.html#city-captured">execution points documentation</a>:</p>

<blockquote>
<h3 id="city-captured">
  
  
    <strong>City Captured</strong> <a href="#city-captured"><span class="self-link">&#128279</span></a>
  
  
</h3>
    

  <p>This execution point is triggered when a city is captured by another tribe.  The execution point takes place after the city has been captured, but before the units supported by the city are disbanded.</p>
</blockquote>

<blockquote>
  <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="n">defender</span><span class="p">)</span> 
   <span class="c1">--civ.ui.text(city.name.." taken from "..defender.name.." discrete event")</span>

<span class="k">end</span><span class="p">)</span>

</code></pre></div>  </div>

  <p>The <code class="language-plaintext highlighter-rouge">city</code> is the city that was captured.</p>

  <p>The <code class="language-plaintext highlighter-rouge">defender</code> is the tribe that owned the city before it was captured.  To get the tribe that captured the city, use <code class="language-plaintext highlighter-rouge">city.owner</code>.</p>
</blockquote>

<p>So, the captured city and the city’s previous owner are provided to us, using the corresponding TOTPP <em>objects</em>.  Next, we have the <em>if statement</em>, which is split over several lines.  Let’s look at the first line:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="p">(</span><span class="n">city</span> <span class="o">==</span> <span class="n">lilybaeum</span> <span class="ow">or</span> <span class="n">city</span> <span class="o">==</span> <span class="n">syracuse</span><span class="p">)</span> <span class="ow">and</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">(</code> and <code class="language-plaintext highlighter-rouge">)</code> means that the code inside them is resolved first, so we look at <code class="language-plaintext highlighter-rouge">city == lilybaeum or city == syracuse</code> first.  The <code class="language-plaintext highlighter-rouge">==</code> operator checks for equality between the items on either side, so this code first evaluates whether the captured city is the same city as Lilybaeum and whether the captured city is Syracuse.</p>

<p>Next, we look at the <code class="language-plaintext highlighter-rouge">or</code> operator.  The expression <code class="language-plaintext highlighter-rouge">a or b</code> returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">a</code> is <code class="language-plaintext highlighter-rouge">true</code>, if <code class="language-plaintext highlighter-rouge">b</code> is <code class="language-plaintext highlighter-rouge">true</code>, or if both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are <code class="language-plaintext highlighter-rouge">true</code>.  It returns <code class="language-plaintext highlighter-rouge">false</code> if both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are <code class="language-plaintext highlighter-rouge">false</code>.</p>

<p>Therefore, <code class="language-plaintext highlighter-rouge">(city == lilybaeum or city == syracuse)</code> evaluates to true if and only if the captured city was either Lilybaeum or Syracuse.  For the rest of this analysis, let’s replace that with <code class="language-plaintext highlighter-rouge">correctCityCaptured</code>, which will be <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">correctCityCaptured</span> <span class="ow">and</span>
        <span class="n">syracuse</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="ow">and</span> 
        <span class="n">lilybaeum</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="k">then</span>
</code></pre></div></div>
<p>Here, <code class="language-plaintext highlighter-rouge">syracuse.owner == romans</code> is <code class="language-plaintext highlighter-rouge">true</code> if the Romans own Syracuse, and similarly, <code class="language-plaintext highlighter-rouge">lilybaeum.owner == romans</code> if the Romans own Lilybaeum.  Since the <code class="language-plaintext highlighter-rouge">onCityTaken</code> event happens <em>after</em> the <em>cityObject</em>’s <code class="language-plaintext highlighter-rouge">owner</code> field is changed to the conqueror, both of these will be <code class="language-plaintext highlighter-rouge">true</code> at the moment the Romans complete their conquest of Sicily.</p>

<p>Now, we look at the <code class="language-plaintext highlighter-rouge">and</code> operator.  The expression <code class="language-plaintext highlighter-rouge">a and b</code> returns <code class="language-plaintext highlighter-rouge">true</code> only if both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are <code class="language-plaintext highlighter-rouge">true</code>.  If either of them is <code class="language-plaintext highlighter-rouge">false</code>, then <code class="language-plaintext highlighter-rouge">a and b</code> also evaluates as <code class="language-plaintext highlighter-rouge">false</code>.  Furthermore, <code class="language-plaintext highlighter-rouge">a and b and c</code> is <code class="language-plaintext highlighter-rouge">true</code> if and only if <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code>, and <code class="language-plaintext highlighter-rouge">c</code> are all <code class="language-plaintext highlighter-rouge">true</code>.  Therefore, the if statement condition is met if and only if all three conditions are true.</p>
<ol>
  <li>The captured city was Lilybaeum or Syracuse.  (Without this, this event would trigger every time the Romans captured a city after they conquered Sicily.)</li>
  <li>The Romans own Syracuse</li>
  <li>The Romans own Lilybaeum</li>
</ol>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have captured "</span><span class="o">..</span><span class="n">city</span><span class="p">.</span><span class="n">name</span><span class="o">..</span>
        <span class="s2">" from the "</span><span class="o">..</span><span class="n">defender</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" and, in so doing, have "</span><span class="o">..</span>
        <span class="s2">"completed their conquest of the island of Sicily."</span><span class="p">)</span>
</code></pre></div></div>
<p>This is, once again, joining strings together to form a message.  The only new thing to note here is that I split the message into several lines using the <code class="language-plaintext highlighter-rouge">..</code> operator.  This is because a string defined by <code class="language-plaintext highlighter-rouge">"</code> marks must be closed on the same line it is opened.</p>

<p>In <strong>discreteEvents.lua</strong>, the event code should look something like this:</p>

<p><img src="04_lesson_images/sicily-event.png" alt="Sicily event" /></p>

<p>Test out the event (cheating, of course), and make sure it displays when completing the conquest of Sicily, but not when conquering another city after owning Sicily.</p>

<p><img src="04_lesson_images/sicily-syracuse.png" alt="Conquest of Sicily" /></p>

<p><img src="04_lesson_images/sicily-lilybaeum.png" alt="Conquest of Sicily" /></p>

<p>Something you may have noticed about the code we just wrote is that the variables we defined are underlined in yellow by the Lua Language Server.  If we look at the message, we see:</p>

<p><img src="04_lesson_images/need-check-nil.png" alt="need check nil" /></p>

<p>The Lua Language Server has noted that both <code class="language-plaintext highlighter-rouge">tile.city</code> and <code class="language-plaintext highlighter-rouge">civ.getTribe</code> can return <code class="language-plaintext highlighter-rouge">nil</code> values, but we’re using variables as if they are not <code class="language-plaintext highlighter-rouge">nil</code> without first checking this in code.  We’ll discuss this kind of check <a href="lessonLinkPlaceholder.html">in another lesson</a>.  However, we have an option to tell the Lua LS that we know the variables are not nil.  We can add the following annotations:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">lilybaeum</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>
<span class="kd">local</span> <span class="n">syracuse</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>
<span class="kd">local</span> <span class="n">romans</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="cm">--[[@as tribeObject]]</span>
</code></pre></div></div>

<p><img src="04_lesson_images/as-annotations.png" alt="as annotations" /></p>

<p>Because the <code class="language-plaintext highlighter-rouge">@as</code> annotation is written like this <code class="language-plaintext highlighter-rouge">--[[@as dataType]]</code> instead of being prefixed by <code class="language-plaintext highlighter-rouge">---</code> because it is an in-line comment.  It has to be that way, because it can sometimes be necessary in function calls:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myFunctionForACity</span><span class="p">(</span><span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span><span class="p">)</span>
</code></pre></div></div>
<p>If the fictional <code class="language-plaintext highlighter-rouge">myFunctionForACity</code> requires a <em>cityObject</em> as the argument, Lua LS would object to what we’ve written without the annotation.</p>
<h2 id="elseif-statements">
  
  
    Elseif Statements <a href="#elseif-statements"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>So far, we’ve used <em>if statements</em> when there is one thing that we might want to do, and <em>if-else statements</em> if there are two things that we might want to do, and we know that we want one of them done.  However, we might have a situation where we want exactly one thing done, but we have more than two possible options.  In this situation, we can use the <code class="language-plaintext highlighter-rouge">elseif</code> keyword to extend an <em>if</em> or <em>if-else</em> statement to contain more possibilities.</p>

<p>Let’s examine an event that shows a message if the Romans capture Carthage, and a different message if the Romans capture a Carthaginian city that isn’t Carthage.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">carthaginians</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="cm">--[[@as tribeObject]]</span>
<span class="kd">local</span> <span class="n">carthage</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>

<span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">city</span><span class="p">,</span> <span class="n">defender</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">city</span><span class="p">.</span><span class="n">owner</span> <span class="o">~=</span> <span class="n">romans</span> <span class="k">then</span>
        <span class="k">return</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">city</span> <span class="o">==</span> <span class="n">carthage</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have won a great victory by capturing "</span><span class="o">..</span><span class="n">carthage</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">"!"</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">defender</span> <span class="o">==</span> <span class="n">carthaginians</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" campaign against the "</span><span class="o">..</span><span class="n">carthaginians</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" is progressing."</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>First, we define a couple useful variables, just as we did for the last event.  This is also an <code class="language-plaintext highlighter-rouge">onCityTaken</code> event.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">carthaginians</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="cm">--[[@as tribeObject]]</span>
<span class="kd">local</span> <span class="n">carthage</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>
<span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">city</span><span class="p">,</span> <span class="n">defender</span><span class="p">)</span>
</code></pre></div></div>

<p>Next, let’s look at this small if statement:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">city</span><span class="p">.</span><span class="n">owner</span> <span class="o">~=</span> <span class="n">romans</span> <span class="k">then</span>
        <span class="k">return</span>
    <span class="k">end</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">~=</code> operator is the <em>not equal to</em> operator, so it evaluates as <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">city.owner</code> is not the <code class="language-plaintext highlighter-rouge">romans</code>, and <code class="language-plaintext highlighter-rouge">false</code> if it is.  The <code class="language-plaintext highlighter-rouge">return</code> line stops the function, so none of the rest of the event happens.  Essentially, these lines check if the conqueror of the city is the Romans, and, if it isn’t, stops the function.  This way, all subsequent code is only triggered if the Romans are the ones who captured the city.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">city</span> <span class="o">==</span> <span class="n">carthage</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have won a great victory by capturing "</span><span class="o">..</span><span class="n">carthage</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">"!"</span><span class="p">)</span>
</code></pre></div></div>
<p>This checks if the captured city is Carthage (since we registered the Carthage <em>cityObject</em> as <code class="language-plaintext highlighter-rouge">carthage</code> earlier).  If it is, the message is shown.  By using <code class="language-plaintext highlighter-rouge">carthage.name</code> our message will change if Carthage is renamed for some reason.</p>

<p>Note that this message will be shown even if Carthage is no longer owned by the Carthaginians.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">elseif</span> <span class="n">defender</span> <span class="o">==</span> <span class="n">carthaginians</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" campaign against the "</span><span class="o">..</span><span class="n">carthaginians</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" is progressing."</span><span class="p">)</span>
    <span class="k">end</span>
</code></pre></div></div>
<p>This section of code checks if the tribe that lost the city is the Carthaginians, and, if so, displays the message.  Because this is an <code class="language-plaintext highlighter-rouge">elseif</code> section, this code will not run if Carthage is the captured city.  Since Carthage triggered an earlier section in the if/elseif block of code, this section will never be triggered for Carthage.</p>

<p>Here’s how this code combines with the previous event.  Note that this event must be <em>after</em> the previous one in <strong>discreteEvents.lua</strong> because it uses the <code class="language-plaintext highlighter-rouge">romans</code> variable, and in Lua, a variable must be defined earlier in the code than when it is used.</p>

<p><img src="04_lesson_images/else-if-example.png" alt="elseif example" /></p>

<p>Save this event, load your game, and try it out.</p>
<h2 id="conclusion">
  
  
    Conclusion <a href="#conclusion"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>In this lesson, we’ve worked with several kinds of TOTPP objects in order to get or change information in the game.  We’ve also worked with <em>if statements</em> so that our code can do different things depending on the arguments provided when the event is triggered.  In the next lesson, we will increase the sophistication of our events through the use of <em>tables</em> and <em>loops</em>.</p>

<table>
  <tbody>
    <tr>
      <td>Previous: <a href="03_valuesAndVariables.html">Values and Variables</a></td>
      <td>Next: <a href="">Tables and Loops</a></td>
    </tr>
  </tbody>
</table>

  </div>
</article>
<!--
    <table>
  <tbody>
    <tr>
      <td>Previous: <a href="03_valuesAndVariables.html">Values and Variables</a></td>
      <td>Next: <a href="">Tables and Loops</a></td>
    </tr>
  </tbody>
</table>
<h1 id="civilization-ii-objects-and-if-statements">
  
  
    <a href="#civilization-ii-objects-and-if-statements">&#128279</a> Civilization II Objects and If Statements
  
  
</h1>
    
<h2 id="introduction">
  
  
    <a href="#introduction">&#128279</a> Introduction
  
  
</h2>
    

<p>So far in these lessons, the only interaction we’ve had with the Civ II game is to show a couple text boxes.  In this lesson, we will introduce a number of new data types which are unique to the Test of Time Patch Project flavour of Lua.  These <em>object</em> data types will provide us with ways to get information about the active game state and rules, and to change those things.</p>

<p>In addition, we’ll also introduce two more data types standard to all versions of Lua, the <em>nil</em> and <em>boolean</em> data types.  We will also see how to use <em>if</em> statements to allow code to sometimes be ignored.</p>
<h2 id="a-scenario-with-the-lua-scenario-template">
  
  
    <a href="#a-scenario-with-the-lua-scenario-template">&#128279</a> A Scenario with the Lua Scenario Template
  
  
</h2>
    

<p>Download <a href="lesson_downloads/ClassicRome-lesson-4.zip">this “ClassicRome” scenario</a>, and extract it into your <strong>Scenario</strong> folder (or wherever you decide is convenient).  This scenario is a combination of files from a Test of Time conversion of the Rome scenario that came with the original Civilization II that I made, and a <a href="https://forums.civfanatics.com/threads/modified-scenarios-workshop.410838/page-48#post-16264049">conversion made by Dadias</a>.  To that, I have added the basic files of the Lua Scenario Template, and generated a couple of customized files using scripts.  For now, just accept that the scenario has been prepared for writing Lua events.</p>

<p>Open Visual Studio Code, and select the “Open Folder” file option.</p>

<p><img src="04_lesson_images/open-folder.png" alt="open folder" /></p>

<p>Select the <strong>ClassicRome</strong> scenario folder, and tell VS Code that you trust the authors if you are asked.  Double check to make sure that <strong>ClassicRome</strong> is the root folder, and not either a subfolder or your <strong>Scenario</strong> folder.</p>

<p>Have a look at the file explorer column.  All the files are listed here, even saved games like <strong>sc_b278.sav</strong> and <strong>ROME.SCN</strong> which you can’t change with VS Code.  There are six folders that contain even more files, mostly <strong>.lua</strong> files to provide functionality to the template.</p>

<p><img src="04_lesson_images/file-explorer-column.png" alt="file explorer column" /></p>
<h2 id="a-persistent-scenario-event">
  
  
    <a href="#a-persistent-scenario-event">&#128279</a> A Persistent Scenario Event
  
  
</h2>
    

<p>In the last lesson, we wrote a simple onTurn event, but we had to use the Load Script button in the Lua Console every time that we loaded a game.  Now, using the Template, we have the event load automatically with the game.  Open <strong>discreteEvents.lua</strong>, and scroll down to line 139, where you will find the following section of code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">---&amp;autoDoc onTurn</span>
<span class="n">discreteEvents</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span> 
    <span class="c1">--civ.ui.text("discrete on turn event 1")</span>
<span class="k">end</span><span class="p">)</span>
<span class="c1">---&amp;endAutoDoc</span>
</code></pre></div></div>
<p><img src="04_lesson_images/d-e-onTurn.png" alt="discreteEvents.onTurn" /></p>

<p>Don’t mind the comments.  <code class="language-plaintext highlighter-rouge">---&amp;autoDoc onTurn</code> and <code class="language-plaintext highlighter-rouge">---&amp;endAutoDoc</code> are annotations that I added for automatically building parts of this website, in this case the <a href="/executionPoints.html">Lua Execution Points</a> page.  You can delete them if you want.  Similarly, the commented out line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">--civ.ui.text("discrete on turn event 1")</span>
</code></pre></div></div>
<p>Is just there for me to uncomment when testing changes to the template.  It can be deleted, too.  In fact, everything within the “Discrete Events” section of this file is just example/testing code and can be removed if you don’t want it.  (The rest of the stuff is “setup” code that we’ll understand later.)</p>

<p>In the last lesson, we built an event that ran the following two lines of code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"It is now turn "</span><span class="o">..</span><span class="nb">tostring</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"This is a second message for turn "</span><span class="o">..</span><span class="n">turn</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
</code></pre></div></div>
<p>Copy these lines into the <code class="language-plaintext highlighter-rouge">discreteEvent.onTurn</code> registration starting at line 139.</p>

<p><img src="04_lesson_images/onTurn-simple.png" alt="onTurn messages" /></p>

<p>Save the file.  Note that although the Lua Language Server detects a couple of “mistakes” in this file, none of them are in our event.  Many files in the template will be coloured yellow, since (at the time of writing this) I haven’t gone through them all to re-document and suppress warnings.  (I wrote most of the Template before I discovered LuaLS.)</p>

<p>This scenario folder comes with a saved game to load, so start Test of Time and load the saved game <strong>sc_b278</strong> in the <strong>ClassicRome</strong> scenario folder.</p>

<p>Press CTRL+N to skip your turn, and see the two messages appear.</p>

<p>It can get a bit tedious to wait for the AI to move just to test onTurn events.  Fortunately, the Lua Scenario Template provides another way.  Open cheat mode, and bring up the console.  In the console, type the following command:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">console</span><span class="p">.</span><span class="n">onTurn</span><span class="p">()</span>
</code></pre></div></div>
<p>This will run the code registered for the onTurn event:</p>

<p><img src="04_lesson_images/console-onTurn.png" alt="console triggered onTurn" /></p>
<h2 id="the-tribeobject-and-nil-data-types">
  
  
    <a href="#the-tribeobject-and-nil-data-types">&#128279</a> The tribeObject and nil Data Types
  
  
</h2>
    

<p>Now, let’s do something a bit more interesting.  The current time to research a technology for the Romans is 80 turns, which seems like it could be a bit too much.  However, if we directly reduce the technology paradigm, that might make technology progress too quickly later in the scenario, or give advantage to large tribes over small ones.  Instead, we’re going to give each tribe one tenth of its total research cost each turn.</p>

<p>In order to do this, we’re going to have to use the <em>tribeObject</em> data type, which is a special data type for the Test of Time Patch Project version of Lua.  It represents certain characteristics of a Civilization in the current game, and we can use commands involving the <em>tribeObject</em> to get information about the tribe, or to change things about it.</p>

<p>Unlike numbers, strings, and functions, we can’t “construct” a tribeObject directly in code.  Instead, we will have to call a function, and get the tribeObject as a returned value.  The function <code class="language-plaintext highlighter-rouge">civ.getTribe</code> is how we will do that.  Here’s the <a href="/auto_doc/civ.html#gettribe">documentation</a>:</p>

<blockquote>
<h3 id="gettribe">
  
  
    <a href="#gettribe">&#128279</a> getTribe
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.getTribe(id: integer)
 -&gt; tribe: tribeObject|nil
</code></pre></div>  </div>
  <p>Returns the tribe with id <code class="language-plaintext highlighter-rouge">id</code> (0-7), or <code class="language-plaintext highlighter-rouge">nil</code> if it doesn’t exist.</p>
</blockquote>

<p>The parameter for <code class="language-plaintext highlighter-rouge">civ.getTribe</code> is the <code class="language-plaintext highlighter-rouge">id</code> of the tribe, which is an integer.  Each tribe has an <code class="language-plaintext highlighter-rouge">id</code> number associated with it, based on its position in the player order.  The barbarians play first, and they have an <code class="language-plaintext highlighter-rouge">id</code> of 0, then the Romans have an <code class="language-plaintext highlighter-rouge">id</code> of 1, and so on, until the Celts, who have an <code class="language-plaintext highlighter-rouge">id</code> of 7.  Next, consider this line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  -&gt; tribe: tribeObject|nil
</code></pre></div></div>
<p>This tells us what the return value of the function is.  <code class="language-plaintext highlighter-rouge">tribe</code> is just a label, like the parameter names.  It gives the programmer information, but Lua itself doesn’t care.  Often, documentation will omit a label for the return value.  The <code class="language-plaintext highlighter-rouge">|</code> character represents “or”, so the line is telling us that this function will return either a <em>tribeObject</em> or a <em>nil</em>.</p>

<p>The <em>nil</em> data type is a special data type, with one possible value: <code class="language-plaintext highlighter-rouge">nil</code>.  It is typically used to represent an absence of data, or “nothing,” rather than data itself.  The function <code class="language-plaintext highlighter-rouge">civ.getTribe(id)</code> returns <code class="language-plaintext highlighter-rouge">nil</code> when the <code class="language-plaintext highlighter-rouge">id</code> argument doesn’t correspond to an actual tribe.  This is a typical use of the <em>nil</em> data type.</p>

<p>Returning to the <em>tribeObject</em> data type, each <em>tribeObject</em> has certain “fields” that we can access (and sometimes change) using the corresponding “key” and a <code class="language-plaintext highlighter-rouge">.</code> to join it to the variable holding the <em>tribeObject</em>:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myTribeObject</span><span class="p">.</span><span class="n">someKey</span>
</code></pre></div></div>
<p>Before writing code in <strong>discreteEvents.lua</strong> or some other script, let’s play around a bit with the <em>tribeObject</em> in the Lua Console.  First, note that the console tells us that</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Global variables are disabled
</code></pre></div></div>
<p>The reason (as I’ve written a fair few times already in these lessons) for this will be explained in the lesson on <a href="lessonLinkPlaceHolde.html">variable scope</a>.  For now, we need to re-enable them, because local variables don’t work in the console.  I’ve included a command in the Lua Scenario Template to do this, but I don’t expect you to memorize the commands one by one as I tell them to you.  Instead, you only need to know one command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>console.commands()
</code></pre></div></div>
<p><img src="04_lesson_images/consoleCommands.png" alt="console commands" /></p>

<p>These are commands (or parts of commands, as we’ll see later) that can be used from the console.  In your own projects, you may find that I’ve removed some of these commands, or added new ones.  The Template still has work to be done, some important, some just polish.  For now, the relevant command for us is <code class="language-plaintext highlighter-rouge">console.restoreGlobal</code>.  Call that (with <code class="language-plaintext highlighter-rouge">()</code>) in the console:</p>

<p><img src="04_lesson_images/global-restored.png" alt="global variables restored" /></p>

<p>Now, let’s assign the <em>tribeObject</em> corresponding to the Romans into the variable <code class="language-plaintext highlighter-rouge">romans</code>:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">romans</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p>Now, let’s <code class="language-plaintext highlighter-rouge">print(romans)</code> and see what we get:</p>

<p><img src="04_lesson_images/print-romans.png" alt="print(romans)" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tribe&lt;id=1, name="Romans", leader="Scipio", money=250, cities=6, units=25, techs=20&gt;
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">Tribe&lt;&gt;</code> indicates that the item we’re printing a representation of is a <em>tribeObject</em>.  The items within the <code class="language-plaintext highlighter-rouge">&lt;&gt;</code> and separated by commas give us information about the fields in the <em>tribeObject</em>.  Most of these are direct key-value pairs for certain fields, but not all.  The <code class="language-plaintext highlighter-rouge">leader</code> field of a <em>tribeObject</em> is actually another Civ II data type: the <em>leaderObject</em>.</p>

<p>For now, type the following commands in the console to see some values for the Roman tribe:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">romans</span><span class="p">.</span><span class="n">id</span>
<span class="n">romans</span><span class="p">.</span><span class="n">name</span>
<span class="n">romans</span><span class="p">.</span><span class="n">adjective</span>
<span class="n">romans</span><span class="p">.</span><span class="n">researchCost</span>
<span class="n">romans</span><span class="p">.</span><span class="n">researchProgress</span>
</code></pre></div></div>

<p><img src="04_lesson_images/roman-fields.png" alt="roman fields" /></p>

<p>Here is the <a href="/auto_doc/tribeObject.html">full list of <em>tribeObject</em> fields</a>.  Let’s look at the documentation of a few fields:</p>

<blockquote>
<h3 id="id">
  
  
    <a href="#id">&#128279</a> id
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.id --&gt; integer
</code></pre></div>  </div>
  <p>(get) Returns the id of the tribe.</p>
</blockquote>

<p>The <code class="language-plaintext highlighter-rouge">tribeObject.id --&gt; integer</code> means that the <code class="language-plaintext highlighter-rouge">id</code> field of the <em>tribeObject</em> has an <em>integer</em> value.</p>

<p>The <code class="language-plaintext highlighter-rouge">(get)</code> means that you can get the value of the <code class="language-plaintext highlighter-rouge">id</code>, but it can’t be changed.</p>

<blockquote>
<h3 id="name">
  
  
    <a href="#name">&#128279</a> name
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.name --&gt; string
</code></pre></div>  </div>
  <p>(get/set) Returns the name of the tribe (e.g. “Romans”).</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">tribeObject.name --&gt; string</code> means that the value of the <code class="language-plaintext highlighter-rouge">name</code> field of a <em>tribeObject</em> is a <em>string</em>.</p>

<p>The <code class="language-plaintext highlighter-rouge">(get/set)</code> means that you can get the value of the <code class="language-plaintext highlighter-rouge">name</code>, but you can also assign a new value to it (“set” it).</p>

<blockquote>
<h3 id="adjective">
  
  
    <a href="#adjective">&#128279</a> adjective
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.adjective --&gt; string
</code></pre></div>  </div>
  <p>(get/set) Returns the adjectival form of the tribe’s name (e.g. “Roman”).</p>
</blockquote>

<p>Like the <code class="language-plaintext highlighter-rouge">name</code> field, the value of this field is a string, and the value can be changed.</p>

<blockquote>
<h3 id="researchcost">
  
  
    <a href="#researchcost">&#128279</a> researchCost
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.researchCost --&gt; integer
</code></pre></div>  </div>
  <p>(get) Returns the research cost of the tribe.</p>
</blockquote>

<p>Like the <code class="language-plaintext highlighter-rouge">id</code> field, the value of this field is an integer, and the field can not be assigned a new value (it is calculated from other game mechanics).</p>

<blockquote>
<h3 id="researchprogress">
  
  
    <a href="#researchprogress">&#128279</a> researchProgress
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.researchProgress --&gt; integer
</code></pre></div>  </div>
  <p>(get/set) Returns the progress towards the current research (range between 0 and tribe.researchCost).</p>
</blockquote>

<p>Like the <code class="language-plaintext highlighter-rouge">researchCost</code> field, the value of this field is an integer.  However, since it is a <code class="language-plaintext highlighter-rouge">(get/set)</code> field, we can assign a new value to it, and we shall do so now.</p>

<p>The syntax to assign a new value to a <em>tribeObject</em>’s field (or a field of any other TOTPP provided object) has this form:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myTribeObject</span><span class="p">.</span><span class="n">fieldKey</span> <span class="o">=</span> <span class="n">newValue</span>
</code></pre></div></div>
<p>So, using the console, we can change the name of the romans to, say, Etruscans.  Similarly, we can change the adjective to Etruscan.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">romans</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Etruscans"</span>
<span class="n">romans</span><span class="p">.</span><span class="n">adjective</span> <span class="o">=</span> <span class="s2">"Etruscan"</span>
</code></pre></div></div>

<p>If we look at the Science Advisor, we find that our tribe is now the Kingdom of the Etruscans:</p>

<p><img src="04_lesson_images/etruscan-science-advisor.png" alt="etruscan science advisor" /></p>

<p>Now, we will go back to the console, and change the research progress.  Thus far, we have used a previously assigned variable as the starting point for our field keys.  However, we could just use <code class="language-plaintext highlighter-rouge">civ.getTribe</code> directly, like this:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">researchProgress</span> <span class="o">=</span> <span class="mi">600</span>
</code></pre></div></div>
<p>Opening the Science Advisor again, we see that extra beakers have been added to the beaker box:</p>

<p><img src="04_lesson_images/more-science.png" alt="more science this time" /></p>

<p>Now, let us get back to our event to give each tribe one tenth of their research cost each turn.</p>

<p>We first need to choose a suitable <a href="/executionPoints.html">“execution point”</a> for our event.  Execution point is a term I use for a place where the game checks if there is Lua code registered to be executed, and, if there is, runs the code before continuing with the game.  This particular event has several reasonable execution points, but I’ve chosen to use <a href="/executionPoints.html#city-processing-complete">onCityProcessingComplete</a>.</p>

<p>There is already an example snippet of code for this execution point in <strong>discreteEvents.lua</strong>, but instead of giving you the line number, I’ll introduce VS Code’s search feature.  Press the search icon <img src="04_lesson_images/search-icon.png" alt="search icon" /> on the left, and that will bring up the search bar.  Type in</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>discreteEvents.onCityProcessingComplete
</code></pre></div></div>
<p>It will help to widen the search tab.  You will get 8 results in 3 files:</p>

<p><img src="04_lesson_images/search-example.png" alt="search example" /></p>

<p>We’re looking for a result in <strong>discreteEvents.lua</strong>, and there are two, highlighted in orange.  Click on the first result.</p>

<p><img src="04_lesson_images/first-instance.png" alt="first result" /></p>

<p>You will be brought here:</p>

<p><img src="04_lesson_images/search-result.png" alt="search result" /></p>

<p>With the result we clicked on in a lighter shade of orange than the other result, which is also highlighted.  Click on the file explorer icon to close the search.</p>

<p>If we hover the cursor over <code class="language-plaintext highlighter-rouge">onCityProcessingComplete</code>, we get some documentation about the function:</p>

<p><img src="04_lesson_images/cityProcessingComplete-info.png" alt="onCityProcessingComplete doc" /></p>

<p>Here, the documentation tells us that the registered function must have two parameters: <code class="language-plaintext highlighter-rouge">turn</code>, which must accept <em>integer</em> arguments, and <code class="language-plaintext highlighter-rouge">tribe</code>, which must accept <em>tribeObject</em> arguments.  Although the documentation doesn’t explicitly tell us this, it is pretty clear that the <code class="language-plaintext highlighter-rouge">turn</code> is an integer giving the current turn number, and <code class="language-plaintext highlighter-rouge">tribe</code> is the tribe that has just finished processing its cities.</p>

<p>First, we can delete the following testing code from our function:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">_global</span><span class="p">.</span><span class="n">eventTesting</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"discreteEvents.onCityProcessingComplete for "</span><span class="o">..</span><span class="n">tribe</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" on turn "</span><span class="o">..</span><span class="nb">tostring</span><span class="p">(</span><span class="n">turn</span><span class="p">))</span>
    <span class="k">end</span>
</code></pre></div></div>

<p>Since the <code class="language-plaintext highlighter-rouge">tribe</code> function argument is already a <em>tribeObject</em>, we don’t need to use <code class="language-plaintext highlighter-rouge">civ.getTribe</code> to access the <em>tribeObject</em> that we need.  Instead, we can move directly to changing the <code class="language-plaintext highlighter-rouge">researchProgress</code> field:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityProcessingComplete</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">,</span><span class="n">tribe</span><span class="p">)</span> 
    <span class="n">tribe</span><span class="p">.</span><span class="n">researchProgress</span> <span class="o">=</span> <span class="n">tribe</span><span class="p">.</span><span class="n">researchProgress</span> <span class="o">+</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">tribe</span><span class="p">.</span><span class="n">researchCost</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s understand this calculation:</p>

<ol>
  <li>We must start with the existing amount of accumulated research, so the right hand side must have <code class="language-plaintext highlighter-rouge">tribe.researchProgress</code>.</li>
  <li>Since we want to give a free 1/10 of research costs each turn, that must be computed, so we must have <code class="language-plaintext highlighter-rouge">tribe.researchCost/10</code>.</li>
  <li>We must assign an <em>integer</em> to <code class="language-plaintext highlighter-rouge">tribe.researchProgress</code>, but division by 10 is not guaranteed to have an integer result.  Therefore, we rely on the standard Lua function <code class="language-plaintext highlighter-rouge">math.floor</code> to round down <code class="language-plaintext highlighter-rouge">tribe.researchCosts/10</code> to the nearest integer.</li>
  <li>The final step of the calculation is to add the existing value to the new increment.</li>
</ol>

<p>Save this new event, and load a saved game.  The science advisor is at about half (unless you saved after making the earlier changes).  We can test this event with the console command <code class="language-plaintext highlighter-rouge">console.onCityProcessingComplete()</code>.  You should see an increased number of beakers.  However, it might not be easily noticeable.  But instead of taking and comparing pictures, we can just change the divisor from 10 to 2. After all, if our code will work when dividing by 2, we’d expect it to work dividing by 10 as well.</p>

<p>So, make the change, save the game, and test the event, both by using <code class="language-plaintext highlighter-rouge">console.onCityProcessingComplete()</code> and by letting the game go through another turn.  Note that the Science Advisor can’t show beyond 100% beakers, so you may have to save and load between tests to see a noticeable difference because the previous research progress was a bit less than half way done.</p>

<p>Remember to change your 2 back to 10!</p>
<h2 id="the-boolean-data-type">
  
  
    <a href="#the-boolean-data-type">&#128279</a> The Boolean Data Type
  
  
</h2>
    

<p>It frequently comes up in programming that we find it convenient to use a data type with only two possible values: <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.  This data type is called the <em>boolean</em> data type, sometimes shortened to “bool.”  The term “Boolean” gets its name from <a href="https://en.wikipedia.org/wiki/Boolean_algebra">George Boole</a>, a mathematician who studied logic where true and false (or 0 and 1) were the only possible values.</p>

<p>Let’s have a look at the <em>tribeObject</em> again.  One of the fields has a boolean value:</p>

<blockquote>
<h3 id="ishuman">
  
  
    <a href="#ishuman">&#128279</a> isHuman
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.isHuman --&gt; boolean
</code></pre></div>  </div>
  <p>(get/set) Returns whether the tribe is a/the human player.</p>
</blockquote>

<p>The value of this field is <code class="language-plaintext highlighter-rouge">true</code> when the tribe is controlled by a human player, and <code class="language-plaintext highlighter-rouge">false</code> when the tribe is controlled by the AI.</p>

<p>There are also a lot of functions that return booleans.  One example is <a href="/auto_doc/civ.html#istribe">civ.isTribe</a>:</p>

<blockquote>
<h3 id="istribe">
  
  
    <a href="#istribe">&#128279</a> isTribe
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.isTribe(object: any)
   -&gt; boolean
</code></pre></div>  </div>
  <p>Returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">object</code> is a tribe, <code class="language-plaintext highlighter-rouge">false</code> otherwise.</p>
</blockquote>

<p>This function accepts any kind of object, and returns a <em>boolean</em>.  It returns <code class="language-plaintext highlighter-rouge">true</code> if the object is a <em>tribeObject</em> and <code class="language-plaintext highlighter-rouge">false</code> otherwise.</p>
<h2 id="if-statements">
  
  
    <a href="#if-statements">&#128279</a> If Statements
  
  
</h2>
    

<p>So, we can now tell if an unknown object is a <em>tribeObject</em> or if a <em>tribeObject</em> is controlled by a human player.  But what good does it do us?  Until now, all the programs we’ve written have always executed the same code.  However, we don’t always have to execute the same instructions each time.  We can use an <em>if statement</em> to execute code only if some value is true.  The syntax for <em>if statements</em> take this form:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- code here is always executed</span>
<span class="k">if</span> <span class="n">value</span> <span class="k">then</span>
    <span class="c1">-- Execute code here only if the value is true</span>
<span class="k">end</span>
<span class="c1">-- code here is always executed</span>
</code></pre></div></div>
<p>That is, when the Lua Interpreter is executing code, and it arrives at an <code class="language-plaintext highlighter-rouge">if</code>, Lua will determine if the value between <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">then</code> is <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.  If the <code class="language-plaintext highlighter-rouge">value</code> is <code class="language-plaintext highlighter-rouge">true</code>, the code between <code class="language-plaintext highlighter-rouge">then</code> and <code class="language-plaintext highlighter-rouge">end</code> is executed.  If the <code class="language-plaintext highlighter-rouge">value</code> is <code class="language-plaintext highlighter-rouge">false</code>, the Lua Interpreter ignores everything until the corresponding <code class="language-plaintext highlighter-rouge">end</code> is reached, at which point it continues executing code.  If <code class="language-plaintext highlighter-rouge">value</code> is something more complicated than a simple variable, the expression will be evaluated to determine if it is <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.</p>

<p>Let’s have a look at a simple event with an <em>if statement</em>:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityProcessingComplete</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">turn</span><span class="p">,</span> <span class="n">tribe</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tribe</span><span class="p">.</span><span class="n">isHuman</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">leaderName</span> <span class="o">=</span> <span class="n">tribe</span><span class="p">.</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">leaderName</span><span class="o">..</span><span class="s2">"!  The "</span><span class="o">..</span><span class="n">tribe</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" Empire awaits your orders."</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>This is another event which takes place after all city production is done for the turn, and the tribe is just about ready to start moving units.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">tribe</span><span class="p">.</span><span class="n">isHuman</span> <span class="k">then</span>
</code></pre></div></div>
<p>This line gets the value registered in the <code class="language-plaintext highlighter-rouge">isHuman</code> field for the currently active tribe.  If it is <code class="language-plaintext highlighter-rouge">false</code>, the code between <code class="language-plaintext highlighter-rouge">then</code> and <code class="language-plaintext highlighter-rouge">end</code> is skipped, which, in this case, brings the Lua interpreter to the end of the function.</p>

<p>If <code class="language-plaintext highlighter-rouge">tribe.isHuman</code> is <code class="language-plaintext highlighter-rouge">true</code>, we progress to the next line:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="kd">local</span> <span class="n">leaderName</span> <span class="o">=</span> <span class="n">tribe</span><span class="p">.</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></div>
<p>On the right hand side, we begin by evaluating <code class="language-plaintext highlighter-rouge">tribe.leader</code>.</p>

<blockquote>
<h3 id="leader">
  
  
    <a href="#leader">&#128279</a> leader
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tribeObject.leader --&gt; leaderObject
</code></pre></div>  </div>
  <p>(get) Returns the leader of the tribe.</p>
</blockquote>

<p>This field references a <a href="/auto_doc/leaderObject.html"><em>leaderObject</em></a>, which is a data type that contains information about a tribe’s leader.  Relevant to us is the name field:</p>

<blockquote>
<h3 id="name-1">
  
  
    <a href="#name-1">&#128279</a> name
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>leaderObject.name --&gt; string
</code></pre></div>  </div>
  <p>(get/set) Returns the name of the leader.</p>
</blockquote>

<p>So, if we call the result of <code class="language-plaintext highlighter-rouge">tribe.leader</code> <code class="language-plaintext highlighter-rouge">leaderOfTribe</code>, then our next step is to evaluate <code class="language-plaintext highlighter-rouge">leaderOfTribe.name</code>, which gives us a string corresponding to the leader’s name.  Therefore, the <code class="language-plaintext highlighter-rouge">leaderName</code> is assigned a string value, which is the tribe leader’s name.</p>

<p>Next, we evaluate</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">leaderName</span><span class="o">..</span><span class="s2">"!  The "</span><span class="o">..</span><span class="n">tribe</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" Empire awaits your orders."</span><span class="p">)</span>
</code></pre></div></div>
<p>This is stuff we’ve seen before.  It is joining several strings together to form a message, and then displaying it.</p>

<p>After this, the <code class="language-plaintext highlighter-rouge">end</code> of the <em>if statement</em> is reached, and, subsequently, the end of the entire function.</p>

<p>Add this code to <strong>discreteEvents.lua</strong>, save the file, re-load your civ game, and test it out.</p>

<p><img src="04_lesson_images/leader-message.png" alt="leader message" /></p>

<p><img src="04_lesson_images/leader-message-displayed.png" alt="leader message displayed" /></p>
<h2 id="if-else-statements">
  
  
    <a href="#if-else-statements">&#128279</a> If-Else Statements
  
  
</h2>
    

<p>In our last example, we checked if <code class="language-plaintext highlighter-rouge">tribe.isHuman</code> was <code class="language-plaintext highlighter-rouge">true</code>, and did something if it was.  If <code class="language-plaintext highlighter-rouge">tribe.isHuman</code> was <code class="language-plaintext highlighter-rouge">false</code>, nothing was done.  However, we will often want to do one thing if a value is <code class="language-plaintext highlighter-rouge">true</code> and something else if it is <code class="language-plaintext highlighter-rouge">false</code>.  The <em>if-else statement</em> provides a simple way to do that.  Here’s the syntax:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">value</span> <span class="k">then</span>
    <span class="c1">-- execute code here if the value is true</span>
    <span class="c1">-- do not execute if the value is false</span>
<span class="k">else</span>
    <span class="c1">-- execute code here if the value is false</span>
    <span class="c1">-- do not execute if the value is true</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Let’s see this syntax in another example.  We’ll add a little bit of flavour to the scenario by changing the name of the leader of the Romans every turn, to reflect the alternating nature of the consulship.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="c1">-- turn is even</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
    <span class="k">else</span>
        <span class="c1">-- turn is odd</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Fabius"</span>
    <span class="k">end</span>    
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>Let’s go through this event:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
</code></pre></div></div>
<p>This is an <code class="language-plaintext highlighter-rouge">onTurn</code> event (so it takes place after the Celts move and before the Barbarians move), and the <code class="language-plaintext highlighter-rouge">turn</code> parameter will be the number of the turn that is starting.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
</code></pre></div></div>
<p>This line introduces two new operators, <code class="language-plaintext highlighter-rouge">%</code> and <code class="language-plaintext highlighter-rouge">==</code>.  <code class="language-plaintext highlighter-rouge">turn % 2</code> is evaluated first, so let’s start with <code class="language-plaintext highlighter-rouge">%</code>, the “<a href="https://en.wikipedia.org/wiki/Modulo">modulo operator</a>.”  The modulo operator gets the remainder of a division.  Usually, when we divide one number by another, we don’t get an even split.  For example <include src="/_MqyOYAnrWb@S4LTBF8NtED.xml"></include>.  This is what makes sense in most contexts.  However, another way to describe the division is <include src="/_gQG3rn$uDaqz7YZVsomwIi.xml"></include> with remainder <include src="/_0uvVEyplMQXkK2O9dn7sA6.xml"></include>.  That is, we can make 2 groups of 4 out of 11, but we still have 3 left over.  This <code class="language-plaintext highlighter-rouge">%</code> operator extracts that 3 for us in this example.  So, <code class="language-plaintext highlighter-rouge">11 % 4</code> evaluates as <code class="language-plaintext highlighter-rouge">3</code> because 3 is the left over remainder when dividing 11 by 4.</p>

<p>In the case of <code class="language-plaintext highlighter-rouge">turn % 2</code>, the result can either be <code class="language-plaintext highlighter-rouge">0</code> (<code class="language-plaintext highlighter-rouge">turn</code> is an even integer, so there is 0 left over when dividing by 2) or <code class="language-plaintext highlighter-rouge">1</code> (<code class="language-plaintext highlighter-rouge">turn</code> is an odd integer, so there is 1 left over when dividing by 2).</p>

<p>The <code class="language-plaintext highlighter-rouge">==</code> operator checks if the values to either side are equal.  If they are, the result is <code class="language-plaintext highlighter-rouge">true</code>, otherwise, the result is <code class="language-plaintext highlighter-rouge">false</code>.  So, if <code class="language-plaintext highlighter-rouge">turn</code> is an even integer, then <code class="language-plaintext highlighter-rouge">turn % 2</code> evaluates to <code class="language-plaintext highlighter-rouge">0</code>, and then <code class="language-plaintext highlighter-rouge">0 == 0</code> evaluates to <code class="language-plaintext highlighter-rouge">true</code>.  If we go through each step of evaluating the line, if the <code class="language-plaintext highlighter-rouge">turn</code> is even, we get</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- suppose turn = 4</span>
    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">4</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="kc">true</span> <span class="k">then</span>
</code></pre></div></div>
<p>If <code class="language-plaintext highlighter-rouge">turn</code> is an odd number, then</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- suppose turn = 5</span>
    <span class="k">if</span> <span class="n">turn</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">5</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">if</span> <span class="kc">false</span> <span class="k">then</span>
</code></pre></div></div>
<p>Our next line of code (plus the comment above it) is:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">-- turn is even</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
</code></pre></div></div>
<p>This code is run if the turn is even.  This is the first time we’ve had to evaluate the left hand side of an <code class="language-plaintext highlighter-rouge">=</code> sign assignment.  We can do this when we are assigning a value to a field.  The evaluation is as follows:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
    <span class="n">romanTribeObject</span><span class="p">.</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
    <span class="n">romanTribeLeader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Scipio"</span>
</code></pre></div></div>
<p>So, if <code class="language-plaintext highlighter-rouge">turn % 2 == 0</code> we change the name of the Roman Leader to Scipio, and ignore everything between <code class="language-plaintext highlighter-rouge">else</code> and <code class="language-plaintext highlighter-rouge">end</code>.  Otherwise, we skip this line of code and process this line instead:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">-- turn is odd</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">leader</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Fabius"</span>
</code></pre></div></div>
<p>The evaluation is exactly the same as above, except that the leader name is set to <code class="language-plaintext highlighter-rouge">"Fabius"</code> instead.</p>

<p>Here’s the code typed into VS Code in <strong>discreteEvents.lua</strong></p>

<p><img src="04_lesson_images/scipio-fabius-event.png" alt="Scipio and Fabius Swap" /></p>

<p>Save the file, load your game again, and test this new event.  Not only will you receive different messages from our previous event, when you check reports like the Science Advisor, the name of the Roman leader will be different.</p>

<p><img src="04_lesson_images/fabius-text-box.png" alt="fabius leader message" /></p>

<p><img src="04_lesson_images/fabius-defense-minister.png" alt="fabius defense minister" /></p>

<p><img src="04_lesson_images/scipio-text-box.png" alt="scipio leader message" /></p>

<p><img src="04_lesson_images/scipio-trade-advisor.png" alt="scipio trade minister" /></p>
<h2 id="the-and--or-operators">
  
  
    <a href="#the-and--or-operators">&#128279</a> The <code class="language-plaintext highlighter-rouge">and</code> &amp; <code class="language-plaintext highlighter-rouge">or</code> Operators
  
  
</h2>
    

<p>It often happens that we want to write an if statement that is more complicated than a single <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code> evaluation.  We can use the <code class="language-plaintext highlighter-rouge">and</code> and <code class="language-plaintext highlighter-rouge">or</code> operators to combine several boolean values into a single result.</p>

<p>Let’s write an event to show a message when the Romans capture all of Sicily, that is, when they own both Lilybaeum and Syracuse.  To do this, I should first introduce two more TOTPP data types: the <em>tileObject</em> and the <em>cityObject</em>.</p>

<p>The <a href="/auto_doc/tileObject.html"><em>tileObject</em></a> represents a single tile on the map.  It keeps information like the current state of tile improvements, as well as whether there is a tribe that has units defending the tile.  The function <a href="/auto_doc/civ.html#getTile"><code class="language-plaintext highlighter-rouge">civ.getTile(x,y,z)</code></a> can be used to get a <em>tileObject</em> from its coordinates.  For our purposes now, we’re interested in one particular field of the <em>tileObject</em>:</p>

<blockquote>
<h3 id="city">
  
  
    <a href="#city">&#128279</a> city
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tileObject.city --&gt; cityObject|nil
</code></pre></div>  </div>
  <p>(get) Returns the city at the tile’s location, or <code class="language-plaintext highlighter-rouge">nil</code> if there’s no city there.</p>
</blockquote>

<p>We will use the <code class="language-plaintext highlighter-rouge">city</code> field of specific <em>tileObjects</em> in order to get <em>cityObjects</em> for the cities of Lilybaeum and Syracuse.  A <em>cityObject</em> has fields for characteristics such as city size, the current production order, and accumulated shields.  What we need for now, however, is the <code class="language-plaintext highlighter-rouge">owner</code> field:</p>

<blockquote>
<h3 id="owner">
  
  
    <a href="#owner">&#128279</a> owner
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cityObject.owner --&gt; tribeObject
</code></pre></div>  </div>
  <p>(get/set) Returns the city’s owner.</p>
</blockquote>

<p>Find the sample code for <code class="language-plaintext highlighter-rouge">discreteEvents.onCityTaken</code> in <strong>discreteEvents.lua</strong>.  You may wish to practice with the search feature again.  Since the example code is there, we might as well do something with it.</p>

<p><img src="04_lesson_images/sample-onCityTaken.png" alt="onCityTaken sample discrete event" /></p>

<p>We’ll begin by storing the <em>cityObjects</em> corresponding to Lilybaeum and Syracuse in appropriately named variables.  While we’re at it, we will give a name to the Romans tribe object:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">lilybaeum</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span>
<span class="kd">local</span> <span class="n">syracuse</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span>
<span class="kd">local</span> <span class="n">romans</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>
<p>It is easy to get the coordinates of a city from the game.  That allows us to get the <em>tileObject</em> of the tile the city is on, and from there, we reference the <code class="language-plaintext highlighter-rouge">city</code> field to get the relevant <em>cityObject</em>.  By assigning these city and tribe objects to well named variables, the rest of our code will be more readable.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="n">defender</span><span class="p">)</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">city</span> <span class="o">==</span> <span class="n">lilybaeum</span> <span class="ow">or</span> <span class="n">city</span> <span class="o">==</span> <span class="n">syracuse</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">syracuse</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="ow">and</span> 
        <span class="n">lilybaeum</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have captured "</span><span class="o">..</span><span class="n">city</span><span class="p">.</span><span class="n">name</span><span class="o">..</span>
        <span class="s2">" from the "</span><span class="o">..</span><span class="n">defender</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" and, in so doing, have "</span><span class="o">..</span>
        <span class="s2">"completed their conquest of the island of Sicily."</span><span class="p">)</span>
    <span class="k">end</span>        
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>Let’s begin with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="n">defender</span><span class="p">)</span> 
</code></pre></div></div>
<p>From the <a href="/executionPoints.html#city-captured">execution points documentation</a>:</p>

<blockquote>
<h3 id="city-captured">
  
  
    <a href="#city-captured">&#128279</a> <strong>City Captured</strong>
  
  
</h3>
    

  <p>This execution point is triggered when a city is captured by another tribe.  The execution point takes place after the city has been captured, but before the units supported by the city are disbanded.</p>
</blockquote>

<blockquote>
  <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="n">defender</span><span class="p">)</span> 
   <span class="c1">--civ.ui.text(city.name.." taken from "..defender.name.." discrete event")</span>

<span class="k">end</span><span class="p">)</span>

</code></pre></div>  </div>

  <p>The <code class="language-plaintext highlighter-rouge">city</code> is the city that was captured.</p>

  <p>The <code class="language-plaintext highlighter-rouge">defender</code> is the tribe that owned the city before it was captured.  To get the tribe that captured the city, use <code class="language-plaintext highlighter-rouge">city.owner</code>.</p>
</blockquote>

<p>So, the captured city and the city’s previous owner are provided to us, using the corresponding TOTPP <em>objects</em>.  Next, we have the <em>if statement</em>, which is split over several lines.  Let’s look at the first line:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="p">(</span><span class="n">city</span> <span class="o">==</span> <span class="n">lilybaeum</span> <span class="ow">or</span> <span class="n">city</span> <span class="o">==</span> <span class="n">syracuse</span><span class="p">)</span> <span class="ow">and</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">(</code> and <code class="language-plaintext highlighter-rouge">)</code> means that the code inside them is resolved first, so we look at <code class="language-plaintext highlighter-rouge">city == lilybaeum or city == syracuse</code> first.  The <code class="language-plaintext highlighter-rouge">==</code> operator checks for equality between the items on either side, so this code first evaluates whether the captured city is the same city as Lilybaeum and whether the captured city is Syracuse.</p>

<p>Next, we look at the <code class="language-plaintext highlighter-rouge">or</code> operator.  The expression <code class="language-plaintext highlighter-rouge">a or b</code> returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">a</code> is <code class="language-plaintext highlighter-rouge">true</code>, if <code class="language-plaintext highlighter-rouge">b</code> is <code class="language-plaintext highlighter-rouge">true</code>, or if both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are <code class="language-plaintext highlighter-rouge">true</code>.  It returns <code class="language-plaintext highlighter-rouge">false</code> if both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are <code class="language-plaintext highlighter-rouge">false</code>.</p>

<p>Therefore, <code class="language-plaintext highlighter-rouge">(city == lilybaeum or city == syracuse)</code> evaluates to true if and only if the captured city was either Lilybaeum or Syracuse.  For the rest of this analysis, let’s replace that with <code class="language-plaintext highlighter-rouge">correctCityCaptured</code>, which will be <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">correctCityCaptured</span> <span class="ow">and</span>
        <span class="n">syracuse</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="ow">and</span> 
        <span class="n">lilybaeum</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">romans</span> <span class="k">then</span>
</code></pre></div></div>
<p>Here, <code class="language-plaintext highlighter-rouge">syracuse.owner == romans</code> is <code class="language-plaintext highlighter-rouge">true</code> if the Romans own Syracuse, and similarly, <code class="language-plaintext highlighter-rouge">lilybaeum.owner == romans</code> if the Romans own Lilybaeum.  Since the <code class="language-plaintext highlighter-rouge">onCityTaken</code> event happens <em>after</em> the <em>cityObject</em>’s <code class="language-plaintext highlighter-rouge">owner</code> field is changed to the conqueror, both of these will be <code class="language-plaintext highlighter-rouge">true</code> at the moment the Romans complete their conquest of Sicily.</p>

<p>Now, we look at the <code class="language-plaintext highlighter-rouge">and</code> operator.  The expression <code class="language-plaintext highlighter-rouge">a and b</code> returns <code class="language-plaintext highlighter-rouge">true</code> only if both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are <code class="language-plaintext highlighter-rouge">true</code>.  If either of them is <code class="language-plaintext highlighter-rouge">false</code>, then <code class="language-plaintext highlighter-rouge">a and b</code> also evaluates as <code class="language-plaintext highlighter-rouge">false</code>.  Furthermore, <code class="language-plaintext highlighter-rouge">a and b and c</code> is <code class="language-plaintext highlighter-rouge">true</code> if and only if <code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">b</code>, and <code class="language-plaintext highlighter-rouge">c</code> are all <code class="language-plaintext highlighter-rouge">true</code>.  Therefore, the if statement condition is met if and only if all three conditions are true.</p>
<ol>
  <li>The captured city was Lilybaeum or Syracuse.  (Without this, this event would trigger every time the Romans captured a city after they conquered Sicily.)</li>
  <li>The Romans own Syracuse</li>
  <li>The Romans own Lilybaeum</li>
</ol>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have captured "</span><span class="o">..</span><span class="n">city</span><span class="p">.</span><span class="n">name</span><span class="o">..</span>
        <span class="s2">" from the "</span><span class="o">..</span><span class="n">defender</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" and, in so doing, have "</span><span class="o">..</span>
        <span class="s2">"completed their conquest of the island of Sicily."</span><span class="p">)</span>
</code></pre></div></div>
<p>This is, once again, joining strings together to form a message.  The only new thing to note here is that I split the message into several lines using the <code class="language-plaintext highlighter-rouge">..</code> operator.  This is because a string defined by <code class="language-plaintext highlighter-rouge">"</code> marks must be closed on the same line it is opened.</p>

<p>In <strong>discreteEvents.lua</strong>, the event code should look something like this:</p>

<p><img src="04_lesson_images/sicily-event.png" alt="Sicily event" /></p>

<p>Test out the event (cheating, of course), and make sure it displays when completing the conquest of Sicily, but not when conquering another city after owning Sicily.</p>

<p><img src="04_lesson_images/sicily-syracuse.png" alt="Conquest of Sicily" /></p>

<p><img src="04_lesson_images/sicily-lilybaeum.png" alt="Conquest of Sicily" /></p>

<p>Something you may have noticed about the code we just wrote is that the variables we defined are underlined in yellow by the Lua Language Server.  If we look at the message, we see:</p>

<p><img src="04_lesson_images/need-check-nil.png" alt="need check nil" /></p>

<p>The Lua Language Server has noted that both <code class="language-plaintext highlighter-rouge">tile.city</code> and <code class="language-plaintext highlighter-rouge">civ.getTribe</code> can return <code class="language-plaintext highlighter-rouge">nil</code> values, but we’re using variables as if they are not <code class="language-plaintext highlighter-rouge">nil</code> without first checking this in code.  We’ll discuss this kind of check <a href="lessonLinkPlaceholder.html">in another lesson</a>.  However, we have an option to tell the Lua LS that we know the variables are not nil.  We can add the following annotations:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">lilybaeum</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>
<span class="kd">local</span> <span class="n">syracuse</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>
<span class="kd">local</span> <span class="n">romans</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="cm">--[[@as tribeObject]]</span>
</code></pre></div></div>

<p><img src="04_lesson_images/as-annotations.png" alt="as annotations" /></p>

<p>Because the <code class="language-plaintext highlighter-rouge">@as</code> annotation is written like this <code class="language-plaintext highlighter-rouge">--[[@as dataType]]</code> instead of being prefixed by <code class="language-plaintext highlighter-rouge">---</code> because it is an in-line comment.  It has to be that way, because it can sometimes be necessary in function calls:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">myFunctionForACity</span><span class="p">(</span><span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span><span class="p">)</span>
</code></pre></div></div>
<p>If the fictional <code class="language-plaintext highlighter-rouge">myFunctionForACity</code> requires a <em>cityObject</em> as the argument, Lua LS would object to what we’ve written without the annotation.</p>
<h2 id="elseif-statements">
  
  
    <a href="#elseif-statements">&#128279</a> Elseif Statements
  
  
</h2>
    

<p>So far, we’ve used <em>if statements</em> when there is one thing that we might want to do, and <em>if-else statements</em> if there are two things that we might want to do, and we know that we want one of them done.  However, we might have a situation where we want exactly one thing done, but we have more than two possible options.  In this situation, we can use the <code class="language-plaintext highlighter-rouge">elseif</code> keyword to extend an <em>if</em> or <em>if-else</em> statement to contain more possibilities.</p>

<p>Let’s examine an event that shows a message if the Romans capture Carthage, and a different message if the Romans capture a Carthaginian city that isn’t Carthage.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">carthaginians</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="cm">--[[@as tribeObject]]</span>
<span class="kd">local</span> <span class="n">carthage</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>

<span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">city</span><span class="p">,</span> <span class="n">defender</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">city</span><span class="p">.</span><span class="n">owner</span> <span class="o">~=</span> <span class="n">romans</span> <span class="k">then</span>
        <span class="k">return</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">city</span> <span class="o">==</span> <span class="n">carthage</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have won a great victory by capturing "</span><span class="o">..</span><span class="n">carthage</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">"!"</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">defender</span> <span class="o">==</span> <span class="n">carthaginians</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" campaign against the "</span><span class="o">..</span><span class="n">carthaginians</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" is progressing."</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div></div>
<p>First, we define a couple useful variables, just as we did for the last event.  This is also an <code class="language-plaintext highlighter-rouge">onCityTaken</code> event.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">carthaginians</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTribe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="cm">--[[@as tribeObject]]</span>
<span class="kd">local</span> <span class="n">carthage</span> <span class="o">=</span> <span class="n">civ</span><span class="p">.</span><span class="n">getTile</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">0</span><span class="p">).</span><span class="n">city</span> <span class="cm">--[[@as cityObject]]</span>
<span class="n">discreteEvents</span><span class="p">.</span><span class="n">onCityTaken</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">city</span><span class="p">,</span> <span class="n">defender</span><span class="p">)</span>
</code></pre></div></div>

<p>Next, let’s look at this small if statement:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">city</span><span class="p">.</span><span class="n">owner</span> <span class="o">~=</span> <span class="n">romans</span> <span class="k">then</span>
        <span class="k">return</span>
    <span class="k">end</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">~=</code> operator is the <em>not equal to</em> operator, so it evaluates as <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">city.owner</code> is not the <code class="language-plaintext highlighter-rouge">romans</code>, and <code class="language-plaintext highlighter-rouge">false</code> if it is.  The <code class="language-plaintext highlighter-rouge">return</code> line stops the function, so none of the rest of the event happens.  Essentially, these lines check if the conqueror of the city is the Romans, and, if it isn’t, stops the function.  This way, all subsequent code is only triggered if the Romans are the ones who captured the city.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">city</span> <span class="o">==</span> <span class="n">carthage</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" have won a great victory by capturing "</span><span class="o">..</span><span class="n">carthage</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">"!"</span><span class="p">)</span>
</code></pre></div></div>
<p>This checks if the captured city is Carthage (since we registered the Carthage <em>cityObject</em> as <code class="language-plaintext highlighter-rouge">carthage</code> earlier).  If it is, the message is shown.  By using <code class="language-plaintext highlighter-rouge">carthage.name</code> our message will change if Carthage is renamed for some reason.</p>

<p>Note that this message will be shown even if Carthage is no longer owned by the Carthaginians.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">elseif</span> <span class="n">defender</span> <span class="o">==</span> <span class="n">carthaginians</span> <span class="k">then</span>
        <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"The "</span><span class="o">..</span><span class="n">romans</span><span class="p">.</span><span class="n">adjective</span><span class="o">..</span><span class="s2">" campaign against the "</span><span class="o">..</span><span class="n">carthaginians</span><span class="p">.</span><span class="n">name</span><span class="o">..</span><span class="s2">" is progressing."</span><span class="p">)</span>
    <span class="k">end</span>
</code></pre></div></div>
<p>This section of code checks if the tribe that lost the city is the Carthaginians, and, if so, displays the message.  Because this is an <code class="language-plaintext highlighter-rouge">elseif</code> section, this code will not run if Carthage is the captured city.  Since Carthage triggered an earlier section in the if/elseif block of code, this section will never be triggered for Carthage.</p>

<p>Here’s how this code combines with the previous event.  Note that this event must be <em>after</em> the previous one in <strong>discreteEvents.lua</strong> because it uses the <code class="language-plaintext highlighter-rouge">romans</code> variable, and in Lua, a variable must be defined earlier in the code than when it is used.</p>

<p><img src="04_lesson_images/else-if-example.png" alt="elseif example" /></p>

<p>Save this event, load your game, and try it out.</p>
<h2 id="conclusion">
  
  
    <a href="#conclusion">&#128279</a> Conclusion
  
  
</h2>
    

<p>In this lesson, we’ve worked with several kinds of TOTPP objects in order to get or change information in the game.  We’ve also worked with <em>if statements</em> so that our code can do different things depending on the arguments provided when the event is triggered.  In the next lesson, we will increase the sophistication of our events through the use of <em>tables</em> and <em>loops</em>.</p>

<table>
  <tbody>
    <tr>
      <td>Previous: <a href="03_valuesAndVariables.html">Values and Variables</a></td>
      <td>Next: <a href="">Tables and Loops</a></td>
    </tr>
  </tbody>
</table>
 -->
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
<!--        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
-->
<!--
-->
      </div>
      <div class="footer-col">
        <p>Reference materials and lessons for using Lua to program events for Civilization II: Test of Time</p>
      </div>
    </div>

    <div class="social-links">
<ul class="social-media-list">
  <li><a rel="me" href="https://github.com/ProfGarfield" target="_blank" title="ProfGarfield"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg>ProfGarfield</a></li>
  <li><a rel="me" href="https://www.youtube.com/user/ProfCiv2" target="_blank" title="YouTube"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#youtube"></use></svg>ProfCiv2</a></li>
  <li><a rel="me" href="https://forums.civfanatics.com/members/prof-garfield.43783/" target="_blank" title="Civfanatics Profile"><img src="/assets/civfanatics_icon.png" class="svg-icon grey"></img>Prof. Garfield</a></li>
</ul>
</div>

  </div>

</footer>
</body>

</html>

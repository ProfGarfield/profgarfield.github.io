<!DOCTYPE html>

<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/css/style.css">
  <!--<link rel="icon" type="image/png" href="/assets/civfanatics_icon.png">-->
    <title></title>
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Lua for Civilization II" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Lua for Civilization II | Reference materials and lessons for using Lua to program events for Civilization II: Test of Time</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Lua for Civilization II" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Reference materials and lessons for using Lua to program events for Civilization II: Test of Time" />
<meta property="og:description" content="Reference materials and lessons for using Lua to program events for Civilization II: Test of Time" />
<link rel="canonical" href="/lua_lessons/03_valuesAndVariables.html" />
<meta property="og:url" content="/lua_lessons/03_valuesAndVariables.html" />
<meta property="og:site_name" content="Lua for Civilization II" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Lua for Civilization II" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Reference materials and lessons for using Lua to program events for Civilization II: Test of Time","headline":"Lua for Civilization II","url":"/lua_lessons/03_valuesAndVariables.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body><header class="site-header">
  <div class="wrapper">
    <!--img src="/assets/logo-cfc.png" class="center"--><a class="site-title" rel="author" href="/">Lua for Civilization II</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/auto_doc/autoIndex.html">Function Docs</a><a class="page-link" href="/executionPoints.html">Execution Points</a><a class="page-link" href="/lua_lessons/lessons_toc.html">Lua Lessons</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <head><title>Variables, Values, and Functions (Lesson 3)</title>
</head>
<article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>
  
  <div class="post-content">
    <table>
  <tbody>
    <tr>
      <td>Previous: <a href="02_writingScripts.html">Writing Programs</a></td>
      <td>Next: <a href="04_civObjectsAndIfStatements.html">Civilization II Objects and If Statements</a></td>
    </tr>
  </tbody>
</table>
<h1 id="variables-values-and-functions">
  
  
    Variables, Values, and Functions <a href="#variables-values-and-functions"><span class="self-link">&#128279</span></a>
  
  
</h1>
    
<h2 id="introduction">
  
  
    Introduction <a href="#introduction"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>In this lesson, we’ll see how to store data in “variables” so that they can be used later in the code.  We will also define “functions,” which are a series of commands to be executed together.  As part of this discussion, we’ll learn about some of the <em>kinds</em> of data that a Lua program can have.</p>
<h2 id="assigning-a-value-to-a-variable">
  
  
    Assigning a Value to a Variable <a href="#assigning-a-value-to-a-variable"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>Thus far, when we’ve wanted to show text in the Lua Console, we have specified the text that we want to show in the same line as the <code class="language-plaintext highlighter-rouge">print</code> command.  However, we can, if we want to, specify some of the text early in the code, and then get it later when it is needed.</p>

<p>At the end of the last lesson, the file pinafore.lua looks like this:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"I am the Captain of the Pinafore;"</span><span class="p">)</span>
<span class="c1">--Sailors </span>
<span class="c1">--print("And a right good captain, too!")</span>
<span class="c1">--Captain</span>
<span class="cm">--[[
print("You're very, very good,") -- maybe this line should go
print("And be it understood,")
print("I command a right good crew.")
--Sailors
print("We're very, very good,")
print("And be it understood,")
print("He commands a right good crew.")
]]</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Though related to a peer,"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"I can hand, reef, and steer,"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"And ship a selvagee;"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"I am never known to quail"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"At the fury of a gale,"</span><span class="p">)</span>
<span class="cm">--[['never, ever' ?]]</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"And I'm never, never sick at sea!"</span><span class="p">)</span>
<span class="c1">--Sailors</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"What, never?"</span><span class="p">)</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"No, never!"</span><span class="p">)</span>
<span class="c1">--Sailors</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"What, never?"</span><span class="p">)</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Hardly ever!"</span><span class="p">)</span>
<span class="c1">--Sailors</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"He's hardly ever sick at sea!"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Then give three cheers, and one cheer more,"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"For the hardy Captain of the Pinafore!\n"</span><span class="p">)</span>
</code></pre></div></div>

<p>Now, suppose that we’re not sure that “Pinafore” is a good name for our ship.  At the moment, if we want to change the name, we must search for every instance of “Pinafore” in our code and manually change it.  This could be tedious, and we might accidentally change an instance of “pinafore” that was used in a different context.
Instead, what we can do is store the text “Pinafore” in a <em>variable</em>, and reference it later in the code, instead of writing “Pinafore” explicitly.</p>

<p>Here is the code to assign a variable:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Pinafore"</span>
</code></pre></div></div>
<p>Let’s break this down.  On the right, we have our <em>value</em> <code class="language-plaintext highlighter-rouge">"Pinafore"</code>.  This kind of value is known as a <em>string</em>.  A string is a sequence of characters in a particular order.  Personally, I think of letters hanging from a string like this:</p>

<p><img src="03_lesson_images/merry-xmas-string.png" alt="merry xmas string" /></p>

<p>(<a href="https://en.wikipedia.org/wiki/String_(computer_science)#History">Wikipedia</a> has a different explanation for the term, if you’re curious.)</p>

<p>The first <code class="language-plaintext highlighter-rouge">"</code> mark tells the Lua Interpreter that a new string is being created, and that all the subsequent characters should be in the string until the next <code class="language-plaintext highlighter-rouge">"</code>.  If you need a <code class="language-plaintext highlighter-rouge">"</code> character in your string, you can write <code class="language-plaintext highlighter-rouge">\"</code>.  Alternatively, you can choose to start and end your string using the <code class="language-plaintext highlighter-rouge">'</code> character instead.</p>

<p>Strings defined using <code class="language-plaintext highlighter-rouge">"</code> or <code class="language-plaintext highlighter-rouge">'</code> must be complete on the same line that they start.  If you want to define a string over multiple lines, the characters <code class="language-plaintext highlighter-rouge">[[</code> and <code class="language-plaintext highlighter-rouge">]]</code> can start and end a string.  This kind of string definition is a bit different.  The sequence <code class="language-plaintext highlighter-rouge">\n</code> will be interpreted as a <code class="language-plaintext highlighter-rouge">\</code> character followed by an <code class="language-plaintext highlighter-rouge">n</code> character, instead of a newline, for example.  You would get a newline by actually pressing enter to get a new line in your text file.</p>

<p>This is enough about strings for now, let’s return to our variable assignment.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Pinafore"</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">=</code> sign means that we’re assigning the value on the right hand side (“Pinafore”) to the variable specified on the left hand side, called <code class="language-plaintext highlighter-rouge">shipName</code> in this example.</p>

<p>In Lua, a variable name can be any sequence of (English) letters (<code class="language-plaintext highlighter-rouge">A</code>-<code class="language-plaintext highlighter-rouge">Z</code>, <code class="language-plaintext highlighter-rouge">a</code>-<code class="language-plaintext highlighter-rouge">z</code>), digits (<code class="language-plaintext highlighter-rouge">0</code>-<code class="language-plaintext highlighter-rouge">9</code>) or underscores (<code class="language-plaintext highlighter-rouge">_</code>), as long as it doesn’t start with a digit, and isn’t one of these special reserved words:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>and     break   do      else    elseif  end     false   for     function        if
in      local   nil     not     or      repeat  return  then    true    until   while
</code></pre></div></div>

<p>Of course, you probably shouldn’t redefine other built in commands, like <code class="language-plaintext highlighter-rouge">print</code>, to be variable names, but the language doesn’t stop you.</p>

<p>Finally, we have the special keyword <code class="language-plaintext highlighter-rouge">local</code>, which, you may notice, is one of the reserved words in the list above.  <code class="language-plaintext highlighter-rouge">local</code> tells the Lua Interpreter that the variable <code class="language-plaintext highlighter-rouge">shipName</code> is only valid within pinafore.lua.  Another file can still have a variable called <code class="language-plaintext highlighter-rouge">shipName</code>, but they will be completely separate.</p>

<p>If we didn’t include the <code class="language-plaintext highlighter-rouge">local</code> keyword, <code class="language-plaintext highlighter-rouge">shipName</code> would be a “global” variable, which could be accessed and modified in the Lua Console, or even other scripts.  There is a future lesson on <a href="lessonLinkPlaceHolder.html">variable “scope”</a> where we will go into more detail.  For now, use this rule: if you are defining a variable in the Lua Console (local variables last one line in the Console), or want to be able to access your variable from the Lua Console, use a global variable.  Otherwise, use a local variable.</p>

<p>Let’s add the following code to the top of pinafore.lua:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Pinafore"</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shipName</span><span class="p">)</span>
</code></pre></div></div>
<p>As you start typing <code class="language-plaintext highlighter-rouge">shipName</code>, you will get a suggestion box.  If you like, you can press Tab or Enter in order to choose <code class="language-plaintext highlighter-rouge">shipName</code> as the value.</p>

<p><img src="03_lesson_images/ship-name-suggestion.png" alt="suggestion" /></p>

<p>Save pinafore.lua, and load the script in the Lua Console.  The first line printed will be Pinafore:</p>

<p><img src="03_lesson_images/print-shipName.png" alt="print shipName variable" /></p>

<p>Printing the <code class="language-plaintext highlighter-rouge">shipName</code> is nice, but what we really want to do is combine the variable with other strings that we’re printing.  In Lua, we can join strings together using 2 periods together: <code class="language-plaintext highlighter-rouge">..</code>.  This means that in pinafore.lua, we replace the line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"I am the Captain of the Pinafore;"</span><span class="p">)</span>
</code></pre></div></div>
<p>with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"I am the Captain of the "</span><span class="o">..</span><span class="n">shipName</span><span class="o">..</span><span class="s2">";"</span><span class="p">)</span>
</code></pre></div></div>
<p>and the line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"For the hardy Captain of the Pinafore!\n"</span><span class="p">)</span>
</code></pre></div></div>
<p>with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"For the hardy Captain of the "</span><span class="o">..</span><span class="n">shipName</span><span class="o">..</span><span class="s2">"!\n"</span><span class="p">)</span>
</code></pre></div></div>
<p>While we’re at it, we can remove the line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">shipName</span><span class="p">)</span>
</code></pre></div></div>

<p>While typing these changes into VS Code, you may have had 2 <code class="language-plaintext highlighter-rouge">"</code> characters typed, when you only typed one.  You can remove this behaviour by going into the Settings and changing <strong>Auto Closing Quotes</strong>.  Note that typically, when VS Code automatically inserts a “closing” character after your cursor, when you type that character, it overwrites the inserted character.  So, the feature won’t interrupt your typing as much as you might think.</p>

<p>The script will look like this:</p>

<p><img src="03_lesson_images/pinafore-ship-name.png" alt="pinafore with shipName variable" /></p>

<p>Run the script, and the (abridged) song will once again be printed:</p>

<p><img src="03_lesson_images/pinafore-abridged-song.png" alt="pinafore abridged song" /></p>

<p>Now, we can easily change the name of the ship in the song simply by changing the <code class="language-plaintext highlighter-rouge">shipName</code> variable.</p>

<p>For example, we can change the ship name from Pinafore to Manticore by changing the variable assignment to:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Manticore"</span>
</code></pre></div></div>

<p>Running the script again gives us:</p>

<p><img src="03_lesson_images/manticore-abridged-song.png" alt="manticore abridged song" /></p>
<h2 id="manipulating-numbers">
  
  
    Manipulating Numbers <a href="#manipulating-numbers"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>Let us turn our attention to manipulating numbers.  We will write a script which will convert a distance in kilometres to the equivalent distance in miles.</p>

<p>Create a new file in VS Code, and name it <strong>conversion.lua</strong>.  We will define a variable that is our distance to convert:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">distanceInKm</span> <span class="o">=</span> <span class="mi">12</span>
</code></pre></div></div>

<p>When we want to create a number in Lua, we need only type that number out.  So, to assign <code class="language-plaintext highlighter-rouge">12</code> to the <code class="language-plaintext highlighter-rouge">distanceInKm</code>, we need only write <code class="language-plaintext highlighter-rouge">12</code> on the right hand side of the <code class="language-plaintext highlighter-rouge">=</code> sign.</p>

<p>Next, we will define some conversion factors to go between different distance units.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">cmPerKm</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="kd">local</span> <span class="n">kmPerCm</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">cmPerKm</span>
<span class="kd">local</span> <span class="n">cmPerInch</span> <span class="o">=</span> <span class="mi">2</span><span class="p">.</span><span class="mi">54</span>
<span class="kd">local</span> <span class="n">inchesPerCm</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">cmPerInch</span>
<span class="kd">local</span> <span class="n">inchesPerFoot</span> <span class="o">=</span> <span class="mi">12</span>
<span class="kd">local</span> <span class="n">feetPerInch</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">inchesPerFoot</span>
<span class="kd">local</span> <span class="n">feetPerMile</span> <span class="o">=</span> <span class="mi">5280</span>
<span class="kd">local</span> <span class="n">milesPerFoot</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">feetPerMile</span>
</code></pre></div></div>
<p>There are three things to notice here.  The first is that we can perform calculations on the right hand side of an <code class="language-plaintext highlighter-rouge">=</code> sign, and then assign the result to a variable.  The second is that the <code class="language-plaintext highlighter-rouge">/</code> symbol indicates division.  So, <code class="language-plaintext highlighter-rouge">a/b</code> computes a divided by b.  The last thing to note is that we can use the value of a variable in a calculation.</p>

<p>Thus far, <strong>conversion.lua</strong> looks like this:</p>

<p><img src="03_lesson_images/unit-conversions.png" alt="conversion.lua" /></p>

<p>Note that some of the variable names are a bit faded.  That is because we’re not using them anywhere in the code.  Let’s now change that by actually performing calculations:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">distanceInKm</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">cmPerKm</span> <span class="c1">-- converting to centimetres</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">inchesPerCm</span> <span class="c1">-- centimetres to inches</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">feetPerInch</span> <span class="c1">-- inches to feet</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">milesPerFoot</span> <span class="c1">-- feet to miles</span>

<span class="nb">print</span><span class="p">(</span><span class="n">convertedDistance</span><span class="p">)</span> 
</code></pre></div></div>
<p>What is happening here is that on the right hand side of the <code class="language-plaintext highlighter-rouge">=</code> we’re using the <code class="language-plaintext highlighter-rouge">*</code> symbol to multiply <code class="language-plaintext highlighter-rouge">convertedDistance</code> by one of the conversion factors, and then assigning the resulting number to the <code class="language-plaintext highlighter-rouge">convertedDistance</code> variable, replacing the existing value.</p>

<p>Before we move on, there is another setting I should mention: <strong>Word Wrap</strong> which is off by default.  Although you are probably using VS code in full screen, I have been using it in half a screen so that it fits better in the column of this webpage.  Without word wrapping, my image looks like this:</p>

<p><img src="03_lesson_images/no-word-wrap.png" alt="no word wrapping" /></p>

<p>After enabling it, I can see my comments.  Notice how there are now gaps in the line numbers, because the lines in the text document are longer than a line on the screen.</p>

<p><img src="03_lesson_images/word-wrap.png" alt="word wrapping" /></p>

<p>Even though you will probably be using VS code in full screen, you will likely end up splitting your editor into several windows, so that you can refer to different files (or parts of the same file) easily.</p>

<p>Now, save <strong>conversion.lua</strong>, and run it to find out how many miles are in 12 kilometres.</p>

<p>It turns out there are this many miles in 12 kilometres:</p>

<p><img src="03_lesson_images/miles-in-12k.png" alt="7.456 miles" /></p>
<h2 id="creating-functions">
  
  
    Creating Functions <a href="#creating-functions"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>At this point, we can convert a distance from kilometres to miles by changing a value in this script, and running the script again.  If we want to make multiple conversions, we would have to copy and paste the part of the code with the <code class="language-plaintext highlighter-rouge">convertedDistance</code> variable for each conversion.  This is inconvenient.  It would also be more convenient if we could make conversions from the command line in the Lua Console, rather than changing and reloading the script.  A <em>function</em> will let us do both these things.</p>

<p>We can write a function like this:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">kilometres</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">kilometres</span><span class="o">*</span><span class="n">cmPerKm</span> <span class="c1">-- km -&gt; cm</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">inchesPerCm</span> <span class="c1">-- cm -&gt; in</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">feetPerInch</span> <span class="c1">-- in -&gt; ft</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">milesPerFoot</span> <span class="c1">-- ft -&gt; mi</span>
    <span class="k">return</span> <span class="n">convertedDistance</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Let’s break down this section of code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span> <span class="o">=</span> 
</code></pre></div></div>
<p>This means that we are going to assign the function that we create to the global variable <code class="language-plaintext highlighter-rouge">kmToMiles</code>.  That’s right.  Lua considers a series of instructions bundled into a <em>function</em> to be a value, the same as a string or number.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="p">(</span><span class="n">kilometres</span><span class="p">)</span>
</code></pre></div></div>
<p>The special word <code class="language-plaintext highlighter-rouge">function</code> tells Lua that we want to define a function, and that the subsequent commands are a part of the function.</p>

<p>The parentheses <code class="language-plaintext highlighter-rouge">()</code> enclose the function <em>parameter</em> <code class="language-plaintext highlighter-rouge">kilometres</code>.  A function parameter is a local variable (only good within the function) whose value is unknown until the function is executed.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">local</span> <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">kilometres</span><span class="o">*</span><span class="n">cmPerKm</span> <span class="c1">-- km -&gt; cm</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">inchesPerCm</span> <span class="c1">-- cm -&gt; in</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">feetPerInch</span> <span class="c1">-- in -&gt; ft</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">milesPerFoot</span> <span class="c1">-- ft -&gt; mi</span>
</code></pre></div></div>
<p>This section contains the commands to perform in order to convert the value supplied by <code class="language-plaintext highlighter-rouge">kilometres</code> into a number representing an equivalent number of miles.  This time, <code class="language-plaintext highlighter-rouge">convertedDistance</code> is a local variable only accessible from within the defined function.</p>

<p>It is also worth noting that these lines are indented.  In Lua, this is just a convention to make code more readable.  The code would work just fine if it were not indented.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">return</span> <span class="n">convertedDistance</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">return</code> keyword tells the function to stop executing.  The value to the right of <code class="language-plaintext highlighter-rouge">return</code> (in this case, <code class="language-plaintext highlighter-rouge">convertedDistance</code>) will be supplied to the part of the program that “called” the function in the first place.  Functions do not have to return values.  For example, the function <code class="language-plaintext highlighter-rouge">print</code> that we’ve been using doesn’t return anything.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">end</span>
</code></pre></div></div>
<p>The special word <code class="language-plaintext highlighter-rouge">end</code> tells the Lua Interpreter that we have reached the end of the function, and there are no more instructions to include.  The function execution also stops here if the code has not reached a <code class="language-plaintext highlighter-rouge">return</code> line before this.</p>

<p>Now that we have a function, let’s see how we would use it to convert 12 kilometres to miles:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
</code></pre></div></div>
<p>What happens here is that the function <code class="language-plaintext highlighter-rouge">kmToMiles</code> is evaluated with value <code class="language-plaintext highlighter-rouge">12</code> as the <em>argument</em>.  <em>Argument</em> is the term used for the value that is assigned to a function parameter, in this case <code class="language-plaintext highlighter-rouge">kilometre</code>.  After <code class="language-plaintext highlighter-rouge">kmToMiles</code> performs calculations on <code class="language-plaintext highlighter-rouge">12</code>, it returns the result: <code class="language-plaintext highlighter-rouge">7.456454306848</code>.  At that point, the above line is equivalent to</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="mi">7</span><span class="p">.</span><span class="mi">456454306848</span><span class="p">)</span>
</code></pre></div></div>
<p>and at this point, the <code class="language-plaintext highlighter-rouge">print</code> function prints the answer to the console.</p>

<p>If we eliminate the redundant code, <strong>conversion.lua</strong> looks like this:</p>

<p><img src="03_lesson_images/conversion-function.png" alt="conversion.lua with function" /></p>

<p>You may notice that kmToMiles is underlined in blue.  Hover your cursor over it to see the complaint:</p>

<p><img src="03_lesson_images/lower-case-global.png" alt="lower case global" /></p>

<p>The Lua Language Server has noticed that <code class="language-plaintext highlighter-rouge">kmToMiles</code> is a global variable, and the convention that Lua Language Server follows is that global variables start with a capital letter.  I don’t follow that convention (and didn’t even know that Lua LS would note this until writing this lesson) because I only use global variables to make functionality available to the console.  The reasons why will be discussed in a <a href="lessonLinkPlaceHolder.html">future lesson</a>.</p>

<p>A light bulb appears near the “spelling mistake” and offers options:</p>

<p><img src="03_lesson_images/click-lightbulb.png" alt="click the lightbulb" /></p>

<p><img src="03_lesson_images/lower-case-global-options.png" alt="options" /></p>

<p>Clicking the first option makes VS Code accept that kmToMiles can be a global variable.</p>

<p>On the topic of spell checking, I use the Code Spell Checker extension by Street Side Software:</p>

<p><img src="03_lesson_images/spell-check-extension.png" alt="spell check extension" /></p>

<p>I will be using this spell checker in lessons from now on.</p>

<p>Now, run <strong>conversion.lua</strong> in the Console.  The result of converting 12 kilometres to miles is once again printed to the console.  However, something that isn’t immediately obvious is that you can now access <code class="language-plaintext highlighter-rouge">kmToMiles</code> from the console command line.  Type the following command to convert 20 kilometres to miles:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></div>
<p>You will find that 20 kilometres is some 12.4 miles:</p>

<p><img src="03_lesson_images/kmToMiles-console.png" alt="kmToMiles console" /></p>

<p>Now, let’s write a function to convert from miles to kilometres.  We’ve already defined the unit conversion rates.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nf">milesToKm</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">miles</span><span class="o">*</span><span class="n">feetPerMile</span><span class="o">*</span><span class="n">inchesPerFoot</span><span class="o">*</span><span class="n">cmPerInch</span><span class="o">*</span><span class="n">kmPerCm</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The first thing to note is that the line that begins the function is different from last time.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nf">milesToKm</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
</code></pre></div></div>
<p>Is an equally valid alternative to</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">milesToKm</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
</code></pre></div></div>
<p>and is, in fact, the way that I usually define functions.  The typical exception would be when I’m defining a function that I’m not assigning to a variable because I only want to use it once.</p>

<p>The other things to note are that I perform calculations on the return line rather than specifying the value of a variable to return and that I can, in fact, perform several multiplications on the same line.</p>

<p>Add this function to your <strong>conversion.lua</strong> file, and a line to print the result of converting 7 miles to kilometres.  Run the resulting script in the console, and test out the <code class="language-plaintext highlighter-rouge">milesToKm</code> function on the command line.</p>

<p><img src="03_lesson_images/conversion-2-fn.png" alt="conversion.lua" /></p>

<p>And the result of running the script, and converting 50 miles to kilometres in the console.  (Note that the first 3 lines were there from earlier.)</p>

<p><img src="03_lesson_images/convert-2-fn-console.png" alt="conversion.lua console results" /></p>
<h2 id="invalid-value-errors">
  
  
    Invalid Value Errors <a href="#invalid-value-errors"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>When programming, sometimes we will make a mistake and cause an error.  We’ve now got enough experience to understand one of the error messages.  If you closed the game at the end of the last section, load the <strong>conversion.lua</strong> script again.</p>

<p>Now, in the command line, enter the following code</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span><span class="p">(</span><span class="s2">"Twelve"</span><span class="p">)</span>
</code></pre></div></div>
<p>You will receive the following error:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; kmToMiles("Twelve")
C:\Games\Test of Time\lua\conversion.lua:11: attempt to perform arithmetic on a string value (local 'kilometres')
stack traceback:
	C:\Games\Test of Time\lua\conversion.lua:11: in function 'kmToMiles'
	(...tail calls...)
</code></pre></div></div>
<p>First, we look at this part of the error:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Games\Test of Time\lua\conversion.lua:11
</code></pre></div></div>
<p>This tells us what file the error was detected in (the path may be different for you, based on where you installed Test of Time), and the line it was detected on, line 11.  (If your <strong>conversion.lua</strong> file doesn’t match mine exactly, the line number may be different.)</p>

<p>Looking at line 11, we see:</p>

<p><img src="03_lesson_images/line-11-error.png" alt="line 11 and surroundings" /></p>

<p>Next, we look at this part of the message:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>attempt to perform arithmetic on a string value (local 'kilometres')
</code></pre></div></div>
<p>This part of the message tells us the detected problem.  We’re trying to do some form of arithmetic (in this case multiplication) on a string (<code class="language-plaintext highlighter-rouge">"twelve"</code>).  This isn’t allowed, so Lua throws an error.</p>

<p>For this part of the error</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stack traceback:
	C:\Games\Test of Time\lua\conversion.lua:11: in function 'kmToMiles'
	(...tail calls...)
</code></pre></div></div>
<p>we will re-generate the error, but inside <strong>conversion.lua</strong> by adding our bad code to line 25 (along with a print command):</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="s2">"twelve"</span><span class="p">))</span>
</code></pre></div></div>
<p>After doing this, the “stack traceback” section looks like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stack traceback:
	C:\Games\Test of Time\lua\conversion.lua:11: in function 'kmToMiles'
	C:\Games\Test of Time\lua\conversion.lua:25: in main chunk
</code></pre></div></div>
<p>Now, we have 2 places referenced.  One is line 11, where the error was detected, and the other is line 25, where we <em>called</em> <code class="language-plaintext highlighter-rouge">kmToMiles</code>.  In this example, line 11 is correct, and our mistake is on line 25.  Of course, the error handler doesn’t know where the problem is.  As far as it is concerned, <code class="language-plaintext highlighter-rouge">"twelve"</code> could be a perfectly valid argument for <code class="language-plaintext highlighter-rouge">kmToMiles</code>, so, we’re given both lines and we must sort it out for ourselves.</p>

<p>Of course, there is only so much the error generator can do for us.  Replace</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="s2">"twelve"</span><span class="p">))</span>
</code></pre></div></div>
<p>with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">twelveVariable</span> <span class="o">=</span> <span class="s2">"twelve"</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="n">twelveVariable</span><span class="p">))</span>

</code></pre></div></div>
<p>and run the script again.  The same error is generated (except that the line is different), so it is up to us to figure out why twelveVariable is a string when we were expecting it to be a number.</p>

<p>Fortunately, the Lua Language Server can detect possible errors, if we annotate our code properly.  On the line above the <code class="language-plaintext highlighter-rouge">kmToMiles</code> definition, type 3 dashes <code class="language-plaintext highlighter-rouge">---</code>, and press enter for the following suggestion:</p>

<p><img src="03_lesson_images/param-return-suggestion.png" alt="param-return suggestion" /></p>

<p>The following code is generated</p>

<p><img src="03_lesson_images/param-return-placed.png" alt="param-return" /></p>

<p>Replace <code class="language-plaintext highlighter-rouge">comment</code> with a basic description of the function, <code class="language-plaintext highlighter-rouge">any</code> with <code class="language-plaintext highlighter-rouge">number</code> and <code class="language-plaintext highlighter-rouge">unknown</code> with <code class="language-plaintext highlighter-rouge">number</code> also.</p>

<p><img src="03_lesson_images/annotated-kmToMiles.png" alt="annotated kmToMiles" /></p>

<p>With this annotation, the name <strong>conversion.lua</strong> is now yellow, and on line 29, <code class="language-plaintext highlighter-rouge">twelveVariable</code> is underlined in yellow.  The Lua Language Server has detected a possible error.  If we hover over the underlined code, we get the following explanation:</p>

<p><img src="03_lesson_images/cant-assign-string-to-number.png" alt="Cannot assign string to number" /></p>

<p>While we’re at it, we can also hover over <code class="language-plaintext highlighter-rouge">kmToMiles</code> and see the documentation that we’ve written for the function:</p>

<p><img src="03_lesson_images/kmToMiles-doc.png" alt="kmToMiles documentation" /></p>

<p>Change <code class="language-plaintext highlighter-rouge">twelveVariable</code> to <code class="language-plaintext highlighter-rouge">12</code> and the yellow will disappear.</p>

<p>This power to document code so it appears in tooltips later (and export it so I could make this website), along with the ability to detect mismatched values is why I chose VS Code with Lua Language Server as the example coding environment for these lessons.  Lua Language Server is open source, so it is available for other programming environments as well.  It should be noted that as far as the Lua Interpreter is concerned, these annotations are just comments, even if VS Code colours them differently, because they all start with <code class="language-plaintext highlighter-rouge">--</code>.</p>
<h2 id="register-an-on-turn-event">
  
  
    Register an On Turn Event <a href="#register-an-on-turn-event"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>We have now reached the point where we can write a simple event, and register it.  We will begin by creating a new file, <strong>onTurnEvent.lua</strong> in the lua folder.</p>

<p>We will use the function <a href="/auto_doc/civ.html#onturn">civ.scen.onTurn</a>, which has the following relevant documentation:</p>

<blockquote>
<h3 id="onturn">
  
  
    onTurn <a href="#onturn"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.scen.onTurn(code: fun(turn: integer))
</code></pre></div>  </div>
  <p>Registers a function that is called at the start of a turn.</p>
</blockquote>

<p>(There is some more information explaining how it relates to other events.)</p>

<p>Let’s have a look at the code block:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nc">civ</span><span class="p">.</span><span class="nf">scen</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">turn</span><span class="p">:</span> <span class="n">integer</span><span class="p">))</span>
</code></pre></div></div>
<p>This part of the documentation tells us how to use this function.  <code class="language-plaintext highlighter-rouge">function civ.scen.onTurn</code> tells us that this is a function that we can call, and that we call it by writing <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> (You may notice that <code class="language-plaintext highlighter-rouge">.</code> is not a valid character for a variable name.  This will be explained <a href="lessonLinkPlaceHolder.html">in a later lesson</a>.)</p>

<p>The part within the <code class="language-plaintext highlighter-rouge">()</code> tells us the parameter name and the kind of argument the function expects for the parameter.  <code class="language-plaintext highlighter-rouge">code</code> tells us that the function’s parameter name is “code” .  We don’t <em>need</em> the parameter name to use the function, but the parameter name can give insight into how the designer expects the function to be used.</p>

<p><code class="language-plaintext highlighter-rouge">: fun()</code> tells us that the <code class="language-plaintext highlighter-rouge">code</code> parameter expects a function as an argument.  <code class="language-plaintext highlighter-rouge">turn: integer</code> means that the function supplied should have one parameter, <code class="language-plaintext highlighter-rouge">turn</code> and that parameter should accept integer arguments.</p>

<p>At the moment, the above couple paragraphs may have been as clear as mud.  Let’s build the event, and hopefully the meaning will be more obvious.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">onTurnEvent</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>

<span class="k">end</span>
</code></pre></div></div>
<p>Here, we define a local function, which has a single parameter, called <code class="language-plaintext highlighter-rouge">turn</code>.  We will add an annotation that the parameter <code class="language-plaintext highlighter-rouge">turn</code> is an integer.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">---@param turn integer</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">onTurnEvent</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>

<span class="k">end</span>
</code></pre></div></div>
<p>Here I should note that, unlike many programming languages, Lua doesn’t distinguish between integers and numbers that can have a fractional part (often called <a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">“floats”</a> or <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">“doubles”</a>).  As far as Lua is concerned, they are both part of the same type.  However, Lua Language Server allows us to make the distinction, since many functions only accept integer arguments.</p>

<p>Our function is now technically suitable to use as an argument for <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code>, although it doesn’t do anything yet.  So, let’s add a line where we use the function with <code class="language-plaintext highlighter-rouge">onTurnEvents</code> as the argument:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">civ</span><span class="p">.</span><span class="n">scen</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="n">onTurnEvent</span><span class="p">)</span>
</code></pre></div></div>
<p>When you try to type in <code class="language-plaintext highlighter-rouge">civ.</code>, you might find that VS Code tries to autocomplete to <code class="language-plaintext highlighter-rouge">civlua.</code> and that you get a box appearing that looks like this:</p>

<p><img src="03_lesson_images/auto-require.png" alt="auto require box" /></p>

<p>Ignore the box (it will go away in a moment), and use backspace to go back to <code class="language-plaintext highlighter-rouge">civ</code>.  If pressing <code class="language-plaintext highlighter-rouge">.</code> again autocompletes, backspace back to <code class="language-plaintext highlighter-rouge">civ</code> then press Escape, which should let you press <code class="language-plaintext highlighter-rouge">.</code> and continue typing.  We got that behaviour because VS Code saw the <strong>civlua.lua</strong> file in our directory, and thought we might want to use code from that file.  The Lua Scenario Template has documentation that tells VS Code that <code class="language-plaintext highlighter-rouge">civ.</code> is a perfectly fine way to start a function, but we’re not using the template yet, so VS Code has no way to know this.</p>

<p>Thus far, our “event” looks like this:</p>

<p><img src="03_lesson_images/onTurn-empty.png" alt="basic onTurn event" /></p>

<p>In the code <code class="language-plaintext highlighter-rouge">civ</code> is underlined as a possible mistake.  When we hover the cursor over it, we get the following message:</p>

<p><img src="03_lesson_images/undefined-global-civ.png" alt="undefined global" /></p>

<p>The Lua Language Server warns us when we’re trying to use a global variable that hasn’t been specified elsewhere, since that often means we’ve made a typo or a mistake.  As I’ve said before, we’ll discuss this more in the <a href="lessonLinkPlaceHolder.html">lesson on variable scope</a>.</p>

<p>For now, click on the “Quick Fix…” option, and then select “Disable diagnostics on this line (undefined-global).”</p>

<p><img src="03_lesson_images/disable-diagnostics.png" alt="disable-diagnostic" /></p>

<p>If you know that the Lua Language Server is making a mistake flagging a particular line, this option creates an annotation that will suppress it.</p>

<p>At this point, although we have an “event,” the event doesn’t actually do anything.  We’ll gain tools over the next couple of lessons to make much more interesting events, but, for now, we will just show a text box telling the player what turn it is.</p>

<p>From the first lesson, we know that <a href="/auto_doc/civ.html#text"><code class="language-plaintext highlighter-rouge">civ.ui.text</code></a> can create text boxes.  Let’s look at the documentation:</p>

<blockquote>
<h3 id="text">
  
  
    text <a href="#text"><span class="self-link">&#128279</span></a>
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.ui.text(string: string, ...string)
</code></pre></div>  </div>
  <p>Display a pop-up text box with the given string as text.</p>

  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">string</code> — text to show in a text box</p>

  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">...</code> — more text</p>
</blockquote>

<p>The first thing that’s different about this documentation is the parameter information: <code class="language-plaintext highlighter-rouge">(string: string, ...string)</code>.  Although we haven’t written a function like that yet, functions are allowed to have more than one parameter/argument.  When they do, each parameter (or argument, when the function is called) is separated by a <code class="language-plaintext highlighter-rouge">,</code>.  This is very common, and we’ll see a lot of that in the upcoming lessons.  What is uncommon is the <code class="language-plaintext highlighter-rouge">...string</code> in place of a <code class="language-plaintext highlighter-rouge">parameterName: valueType</code>.  This means that an arbitrary number of strings can be given as additional arguments.  We won’t use that feature now.</p>

<p>The other different thing is that in this piece of documentation, there is extra information about the function parameters:</p>

<blockquote>
  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">string</code> — text to show in a text box</p>

  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">...</code> — more text</p>
</blockquote>

<p>The <code class="language-plaintext highlighter-rouge">string</code> parameter has the extra information that it is the text to show in the text box, and <code class="language-plaintext highlighter-rouge">...</code> is more text (to be shown).  Sometimes documentation is expressive, and other times it is brief, and we must experiment a bit if the documentation isn’t fully clear.</p>

<p>Since there isn’t much point in doing arithmetic on the turn number, we will settle for a simple message displaying the current turn:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"It is now turn "</span><span class="o">..</span><span class="nb">tostring</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">tostring</code> function is native to Lua and converts a value into a suitable string equivalent.  If you hover your cursor over <code class="language-plaintext highlighter-rouge">tostring</code> in VS Code, you will see the following documentation (ignore the part about “metatables,” that’s advanced stuff).</p>

<p><img src="03_lesson_images/tostring-doc.png" alt="tostring documentation" /></p>

<p>We use <code class="language-plaintext highlighter-rouge">tostring</code> in order to convert <code class="language-plaintext highlighter-rouge">turn</code>, which is a <em>number</em>, to a <em>string</em> which can be joined to other strings using <code class="language-plaintext highlighter-rouge">..</code>.</p>

<p>The Lua Language Server has once again identified <code class="language-plaintext highlighter-rouge">civ</code> as a possible problem, so have diagnostics ignore that line.  Once you’re done, <strong>onTurnEvent.lua</strong> should look like this:</p>

<p><img src="03_lesson_images/on-turn-full-event.png" alt="complete onTurn event" /></p>

<p>Save this file, and save your active Civ II game, so that you can easily reload later.</p>

<p>Open the console, and load the <strong>onTurnEvent.lua</strong> script.  The console will look the same as it did before, since we didn’t have any kind of print statement in this script.  Close the Lua Console, end your turn, and allow the AI to move.  Before you move again, you should get this event message:</p>

<p><img src="03_lesson_images/onTurn-turn-2.png" alt="on turn event" /></p>

<p>Proceed to play, and note how you get a message every turn, with a different turn number.</p>

<p>Now, load your saved game, and play a couple turns.  You will notice that the event does not happen.  Load the <strong>onTurnEvent.lua</strong> script again, verify that it is active by playing until the next turn, and then save the game.  Load this more recent saved game, and play.  You will still find that the event doesn’t happen.</p>

<p>That’s because Lua Events must be registered every time a game is loaded.  When a game is loaded, the Game will automatically check if there is an available file named <strong>events.lua</strong> in its folder, and, if so, run <strong>events.lua</strong> as a script in order to register all of the scenario’s events.  As we’ll see, <strong>events.lua</strong> doesn’t have to contain <em>all</em> the code; it can reference other files to get the necessary code.</p>

<p>When we program events for Civilization II, what we are doing is creating a giant script which defines functions like <code class="language-plaintext highlighter-rouge">onTurnEvent</code>, and then registering them with functions like <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code>.  Once these functions have been registered, a player plays the game, and, at certain <a href="/executionPoints.html">“execution points”</a> the game runs a registered function, supplying certain data.  In our <strong>onTurnEvent.lua</strong> example, at the start of every game turn (between tribe 7 and the barbarian turn), the game feeds the new game turn into the <code class="language-plaintext highlighter-rouge">onTurnEvent</code> function, which uses that information to display a text box with the current turn.</p>

<p>Let’s turn our attention back to <strong>onTurnEvent.lua</strong>.  We will create another text box event:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">aSecondEvent</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
<span class="c1">---@diagnostic disable-next-line: undefined-global</span>
    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"This is a second message for turn "</span><span class="o">..</span><span class="n">turn</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">---@diagnostic disable-next-line: undefined-global</span>
<span class="n">civ</span><span class="p">.</span><span class="n">scen</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="n">aSecondEvent</span><span class="p">)</span>
</code></pre></div></div>
<p>Before I have you add this code to <strong>onTurnEvent.lua</strong> and run the script, I should admit to telling a lie a bit earlier.  In the <code class="language-plaintext highlighter-rouge">onTurnEvent</code> function, I said that we had to use the <code class="language-plaintext highlighter-rouge">tostring</code> function to convert the value for <code class="language-plaintext highlighter-rouge">turn</code> into a string, before we concatenated it using <code class="language-plaintext highlighter-rouge">..</code>.  That is true for most data types, but the <code class="language-plaintext highlighter-rouge">..</code> operator will automatically transform numbers into strings, so we can save a bit of typing.</p>

<p>Now, add this code to <strong>onTurnEvent.lua</strong>, to get:</p>

<p><img src="03_lesson_images/on-turn-two-events-attempt.png" alt="two on turn events attempt" /></p>

<p>Load this script, and play until the next turn.  You will find that only the second message box appears.  Why is that?  Well, that is because the second call to <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> <em>replaced</em> <code class="language-plaintext highlighter-rouge">onTurnEvent</code> with <code class="language-plaintext highlighter-rouge">aSecondEvent</code>, rather than registering <code class="language-plaintext highlighter-rouge">aSecondEvent</code> <em>in addition to</em> <code class="language-plaintext highlighter-rouge">onTurnEvent</code>.  The Lua Scenario Template provides a function <code class="language-plaintext highlighter-rouge">discreteEvents.onTurn</code> which allows you to register onTurn events in discrete blocks, and hides away the call to <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> in a file that a scenario designer is not expected to change.</p>

<p>However, we don’t have access to <code class="language-plaintext highlighter-rouge">discreteEvents.onTurn</code> just yet, so let’s continue using <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code>.  Since we can’t register two functions, we must combine both of the effects into a single function, and only register that one.  This is the result:</p>

<p><img src="03_lesson_images/correct-on-turn-2.png" alt="two message onTurn event" /></p>

<p>Load this script, and get two messages for the onTurn event.</p>
<h2 id="parameter-and-variable-names">
  
  
    Parameter and Variable Names <a href="#parameter-and-variable-names"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>In the last section, we chose to call the parameter for <code class="language-plaintext highlighter-rouge">onTurnEvent</code> <code class="language-plaintext highlighter-rouge">turn</code> because the documentation said that <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> expected a function with a parameter named <code class="language-plaintext highlighter-rouge">turn</code>.  This wasn’t necessary.  “Turn” is how we should interpret the argument passed to <code class="language-plaintext highlighter-rouge">onTurnEvent</code>, but we could name the parameter whatever we wanted.</p>

<p>Let’s try that now.  Move the cursor to one of the <code class="language-plaintext highlighter-rouge">turn</code> variable references, and right click.</p>

<p><img src="03_lesson_images/turn-right-click.png" alt="turn right click" /></p>

<p>Select “Rename Symbol”, and change the name from “turn” to “money”.</p>

<p><img src="03_lesson_images/turn-to-money.png" alt="turn to money" /></p>

<p>Save the script, and run it again.  Even though the onTurn event has nothing to do with money, the event works just fine.</p>

<p>This arbitrary choice of name extends to variable names as well.  Let’s take another look at <strong>conversion.lua</strong>:</p>

<p><img src="03_lesson_images/conversion-lua-again.png" alt="conversion.lua again" /></p>

<p>We can, for example, rename the variable <code class="language-plaintext highlighter-rouge">inchesPerFoot</code> to <code class="language-plaintext highlighter-rouge">inchesPerFurlong</code> (without changing its value), and our program will work just as well as before.  Parameter and variable names are chosen for human convenience.  The Lua Interpreter doesn’t care what they are, as long as they don’t conflict with special words or other assigned variable names.  For example, if we changed the parameter name of <code class="language-plaintext highlighter-rouge">kmToMiles</code> from <code class="language-plaintext highlighter-rouge">kilometres</code> to <code class="language-plaintext highlighter-rouge">cmPerKm</code>, that would break the code.  That’s because the Lua interpreter wouldn’t know that only <em>one</em> of the <code class="language-plaintext highlighter-rouge">cmPerKm</code> variables referred to the function parameter, while the <em>other</em> referred to a variable defined outside the function.</p>
<h2 id="conclusion">
  
  
    Conclusion <a href="#conclusion"><span class="self-link">&#128279</span></a>
  
  
</h2>
    

<p>In this lesson, we’ve learned how to create variables, in order to use data later, and how to write functions, so that we can easily repeat entire sets of instructions.  We’ve also learned about the <em>string</em> and <em>number</em> data types, and registered a function to create an in game event.</p>

<p>In the next lesson, we will use the Lua Scenario Template and write some events for the “Rome” scenario that came with the original Civilization II game.  In doing so, we will learn about more data types and how to make functions that choose whether or not to execute instructions based on the values of the arguments they are supplied.</p>

<table>
  <tbody>
    <tr>
      <td>Previous: <a href="02_writingScripts.html">Writing Programs</a></td>
      <td>Next: <a href="04_civObjectsAndIfStatements.html">Civilization II Objects and If Statements</a></td>
    </tr>
  </tbody>
</table>

  </div>
</article>
<!--
    <table>
  <tbody>
    <tr>
      <td>Previous: <a href="02_writingScripts.html">Writing Programs</a></td>
      <td>Next: <a href="04_civObjectsAndIfStatements.html">Civilization II Objects and If Statements</a></td>
    </tr>
  </tbody>
</table>
<h1 id="variables-values-and-functions">
  
  
    <a href="#variables-values-and-functions">&#128279</a> Variables, Values, and Functions
  
  
</h1>
    
<h2 id="introduction">
  
  
    <a href="#introduction">&#128279</a> Introduction
  
  
</h2>
    

<p>In this lesson, we’ll see how to store data in “variables” so that they can be used later in the code.  We will also define “functions,” which are a series of commands to be executed together.  As part of this discussion, we’ll learn about some of the <em>kinds</em> of data that a Lua program can have.</p>
<h2 id="assigning-a-value-to-a-variable">
  
  
    <a href="#assigning-a-value-to-a-variable">&#128279</a> Assigning a Value to a Variable
  
  
</h2>
    

<p>Thus far, when we’ve wanted to show text in the Lua Console, we have specified the text that we want to show in the same line as the <code class="language-plaintext highlighter-rouge">print</code> command.  However, we can, if we want to, specify some of the text early in the code, and then get it later when it is needed.</p>

<p>At the end of the last lesson, the file pinafore.lua looks like this:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"I am the Captain of the Pinafore;"</span><span class="p">)</span>
<span class="c1">--Sailors </span>
<span class="c1">--print("And a right good captain, too!")</span>
<span class="c1">--Captain</span>
<span class="cm">--[[
print("You're very, very good,") -- maybe this line should go
print("And be it understood,")
print("I command a right good crew.")
--Sailors
print("We're very, very good,")
print("And be it understood,")
print("He commands a right good crew.")
]]</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Though related to a peer,"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"I can hand, reef, and steer,"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"And ship a selvagee;"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"I am never known to quail"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"At the fury of a gale,"</span><span class="p">)</span>
<span class="cm">--[['never, ever' ?]]</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"And I'm never, never sick at sea!"</span><span class="p">)</span>
<span class="c1">--Sailors</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"What, never?"</span><span class="p">)</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"No, never!"</span><span class="p">)</span>
<span class="c1">--Sailors</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"What, never?"</span><span class="p">)</span>
<span class="c1">--Captain</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Hardly ever!"</span><span class="p">)</span>
<span class="c1">--Sailors</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"He's hardly ever sick at sea!"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Then give three cheers, and one cheer more,"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"For the hardy Captain of the Pinafore!\n"</span><span class="p">)</span>
</code></pre></div></div>

<p>Now, suppose that we’re not sure that “Pinafore” is a good name for our ship.  At the moment, if we want to change the name, we must search for every instance of “Pinafore” in our code and manually change it.  This could be tedious, and we might accidentally change an instance of “pinafore” that was used in a different context.
Instead, what we can do is store the text “Pinafore” in a <em>variable</em>, and reference it later in the code, instead of writing “Pinafore” explicitly.</p>

<p>Here is the code to assign a variable:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Pinafore"</span>
</code></pre></div></div>
<p>Let’s break this down.  On the right, we have our <em>value</em> <code class="language-plaintext highlighter-rouge">"Pinafore"</code>.  This kind of value is known as a <em>string</em>.  A string is a sequence of characters in a particular order.  Personally, I think of letters hanging from a string like this:</p>

<p><img src="03_lesson_images/merry-xmas-string.png" alt="merry xmas string" /></p>

<p>(<a href="https://en.wikipedia.org/wiki/String_(computer_science)#History">Wikipedia</a> has a different explanation for the term, if you’re curious.)</p>

<p>The first <code class="language-plaintext highlighter-rouge">"</code> mark tells the Lua Interpreter that a new string is being created, and that all the subsequent characters should be in the string until the next <code class="language-plaintext highlighter-rouge">"</code>.  If you need a <code class="language-plaintext highlighter-rouge">"</code> character in your string, you can write <code class="language-plaintext highlighter-rouge">\"</code>.  Alternatively, you can choose to start and end your string using the <code class="language-plaintext highlighter-rouge">'</code> character instead.</p>

<p>Strings defined using <code class="language-plaintext highlighter-rouge">"</code> or <code class="language-plaintext highlighter-rouge">'</code> must be complete on the same line that they start.  If you want to define a string over multiple lines, the characters <code class="language-plaintext highlighter-rouge">[[</code> and <code class="language-plaintext highlighter-rouge">]]</code> can start and end a string.  This kind of string definition is a bit different.  The sequence <code class="language-plaintext highlighter-rouge">\n</code> will be interpreted as a <code class="language-plaintext highlighter-rouge">\</code> character followed by an <code class="language-plaintext highlighter-rouge">n</code> character, instead of a newline, for example.  You would get a newline by actually pressing enter to get a new line in your text file.</p>

<p>This is enough about strings for now, let’s return to our variable assignment.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Pinafore"</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">=</code> sign means that we’re assigning the value on the right hand side (“Pinafore”) to the variable specified on the left hand side, called <code class="language-plaintext highlighter-rouge">shipName</code> in this example.</p>

<p>In Lua, a variable name can be any sequence of (English) letters (<code class="language-plaintext highlighter-rouge">A</code>-<code class="language-plaintext highlighter-rouge">Z</code>, <code class="language-plaintext highlighter-rouge">a</code>-<code class="language-plaintext highlighter-rouge">z</code>), digits (<code class="language-plaintext highlighter-rouge">0</code>-<code class="language-plaintext highlighter-rouge">9</code>) or underscores (<code class="language-plaintext highlighter-rouge">_</code>), as long as it doesn’t start with a digit, and isn’t one of these special reserved words:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>and     break   do      else    elseif  end     false   for     function        if
in      local   nil     not     or      repeat  return  then    true    until   while
</code></pre></div></div>

<p>Of course, you probably shouldn’t redefine other built in commands, like <code class="language-plaintext highlighter-rouge">print</code>, to be variable names, but the language doesn’t stop you.</p>

<p>Finally, we have the special keyword <code class="language-plaintext highlighter-rouge">local</code>, which, you may notice, is one of the reserved words in the list above.  <code class="language-plaintext highlighter-rouge">local</code> tells the Lua Interpreter that the variable <code class="language-plaintext highlighter-rouge">shipName</code> is only valid within pinafore.lua.  Another file can still have a variable called <code class="language-plaintext highlighter-rouge">shipName</code>, but they will be completely separate.</p>

<p>If we didn’t include the <code class="language-plaintext highlighter-rouge">local</code> keyword, <code class="language-plaintext highlighter-rouge">shipName</code> would be a “global” variable, which could be accessed and modified in the Lua Console, or even other scripts.  There is a future lesson on <a href="lessonLinkPlaceHolder.html">variable “scope”</a> where we will go into more detail.  For now, use this rule: if you are defining a variable in the Lua Console (local variables last one line in the Console), or want to be able to access your variable from the Lua Console, use a global variable.  Otherwise, use a local variable.</p>

<p>Let’s add the following code to the top of pinafore.lua:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Pinafore"</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shipName</span><span class="p">)</span>
</code></pre></div></div>
<p>As you start typing <code class="language-plaintext highlighter-rouge">shipName</code>, you will get a suggestion box.  If you like, you can press Tab or Enter in order to choose <code class="language-plaintext highlighter-rouge">shipName</code> as the value.</p>

<p><img src="03_lesson_images/ship-name-suggestion.png" alt="suggestion" /></p>

<p>Save pinafore.lua, and load the script in the Lua Console.  The first line printed will be Pinafore:</p>

<p><img src="03_lesson_images/print-shipName.png" alt="print shipName variable" /></p>

<p>Printing the <code class="language-plaintext highlighter-rouge">shipName</code> is nice, but what we really want to do is combine the variable with other strings that we’re printing.  In Lua, we can join strings together using 2 periods together: <code class="language-plaintext highlighter-rouge">..</code>.  This means that in pinafore.lua, we replace the line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"I am the Captain of the Pinafore;"</span><span class="p">)</span>
</code></pre></div></div>
<p>with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"I am the Captain of the "</span><span class="o">..</span><span class="n">shipName</span><span class="o">..</span><span class="s2">";"</span><span class="p">)</span>
</code></pre></div></div>
<p>and the line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"For the hardy Captain of the Pinafore!\n"</span><span class="p">)</span>
</code></pre></div></div>
<p>with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="s2">"For the hardy Captain of the "</span><span class="o">..</span><span class="n">shipName</span><span class="o">..</span><span class="s2">"!\n"</span><span class="p">)</span>
</code></pre></div></div>
<p>While we’re at it, we can remove the line</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">shipName</span><span class="p">)</span>
</code></pre></div></div>

<p>While typing these changes into VS Code, you may have had 2 <code class="language-plaintext highlighter-rouge">"</code> characters typed, when you only typed one.  You can remove this behaviour by going into the Settings and changing <strong>Auto Closing Quotes</strong>.  Note that typically, when VS Code automatically inserts a “closing” character after your cursor, when you type that character, it overwrites the inserted character.  So, the feature won’t interrupt your typing as much as you might think.</p>

<p>The script will look like this:</p>

<p><img src="03_lesson_images/pinafore-ship-name.png" alt="pinafore with shipName variable" /></p>

<p>Run the script, and the (abridged) song will once again be printed:</p>

<p><img src="03_lesson_images/pinafore-abridged-song.png" alt="pinafore abridged song" /></p>

<p>Now, we can easily change the name of the ship in the song simply by changing the <code class="language-plaintext highlighter-rouge">shipName</code> variable.</p>

<p>For example, we can change the ship name from Pinafore to Manticore by changing the variable assignment to:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">shipName</span> <span class="o">=</span> <span class="s2">"Manticore"</span>
</code></pre></div></div>

<p>Running the script again gives us:</p>

<p><img src="03_lesson_images/manticore-abridged-song.png" alt="manticore abridged song" /></p>
<h2 id="manipulating-numbers">
  
  
    <a href="#manipulating-numbers">&#128279</a> Manipulating Numbers
  
  
</h2>
    

<p>Let us turn our attention to manipulating numbers.  We will write a script which will convert a distance in kilometres to the equivalent distance in miles.</p>

<p>Create a new file in VS Code, and name it <strong>conversion.lua</strong>.  We will define a variable that is our distance to convert:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">distanceInKm</span> <span class="o">=</span> <span class="mi">12</span>
</code></pre></div></div>

<p>When we want to create a number in Lua, we need only type that number out.  So, to assign <code class="language-plaintext highlighter-rouge">12</code> to the <code class="language-plaintext highlighter-rouge">distanceInKm</code>, we need only write <code class="language-plaintext highlighter-rouge">12</code> on the right hand side of the <code class="language-plaintext highlighter-rouge">=</code> sign.</p>

<p>Next, we will define some conversion factors to go between different distance units.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">cmPerKm</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="kd">local</span> <span class="n">kmPerCm</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">cmPerKm</span>
<span class="kd">local</span> <span class="n">cmPerInch</span> <span class="o">=</span> <span class="mi">2</span><span class="p">.</span><span class="mi">54</span>
<span class="kd">local</span> <span class="n">inchesPerCm</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">cmPerInch</span>
<span class="kd">local</span> <span class="n">inchesPerFoot</span> <span class="o">=</span> <span class="mi">12</span>
<span class="kd">local</span> <span class="n">feetPerInch</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">inchesPerFoot</span>
<span class="kd">local</span> <span class="n">feetPerMile</span> <span class="o">=</span> <span class="mi">5280</span>
<span class="kd">local</span> <span class="n">milesPerFoot</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">feetPerMile</span>
</code></pre></div></div>
<p>There are three things to notice here.  The first is that we can perform calculations on the right hand side of an <code class="language-plaintext highlighter-rouge">=</code> sign, and then assign the result to a variable.  The second is that the <code class="language-plaintext highlighter-rouge">/</code> symbol indicates division.  So, <code class="language-plaintext highlighter-rouge">a/b</code> computes a divided by b.  The last thing to note is that we can use the value of a variable in a calculation.</p>

<p>Thus far, <strong>conversion.lua</strong> looks like this:</p>

<p><img src="03_lesson_images/unit-conversions.png" alt="conversion.lua" /></p>

<p>Note that some of the variable names are a bit faded.  That is because we’re not using them anywhere in the code.  Let’s now change that by actually performing calculations:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">distanceInKm</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">cmPerKm</span> <span class="c1">-- converting to centimetres</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">inchesPerCm</span> <span class="c1">-- centimetres to inches</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">feetPerInch</span> <span class="c1">-- inches to feet</span>
<span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">milesPerFoot</span> <span class="c1">-- feet to miles</span>

<span class="nb">print</span><span class="p">(</span><span class="n">convertedDistance</span><span class="p">)</span> 
</code></pre></div></div>
<p>What is happening here is that on the right hand side of the <code class="language-plaintext highlighter-rouge">=</code> we’re using the <code class="language-plaintext highlighter-rouge">*</code> symbol to multiply <code class="language-plaintext highlighter-rouge">convertedDistance</code> by one of the conversion factors, and then assigning the resulting number to the <code class="language-plaintext highlighter-rouge">convertedDistance</code> variable, replacing the existing value.</p>

<p>Before we move on, there is another setting I should mention: <strong>Word Wrap</strong> which is off by default.  Although you are probably using VS code in full screen, I have been using it in half a screen so that it fits better in the column of this webpage.  Without word wrapping, my image looks like this:</p>

<p><img src="03_lesson_images/no-word-wrap.png" alt="no word wrapping" /></p>

<p>After enabling it, I can see my comments.  Notice how there are now gaps in the line numbers, because the lines in the text document are longer than a line on the screen.</p>

<p><img src="03_lesson_images/word-wrap.png" alt="word wrapping" /></p>

<p>Even though you will probably be using VS code in full screen, you will likely end up splitting your editor into several windows, so that you can refer to different files (or parts of the same file) easily.</p>

<p>Now, save <strong>conversion.lua</strong>, and run it to find out how many miles are in 12 kilometres.</p>

<p>It turns out there are this many miles in 12 kilometres:</p>

<p><img src="03_lesson_images/miles-in-12k.png" alt="7.456 miles" /></p>
<h2 id="creating-functions">
  
  
    <a href="#creating-functions">&#128279</a> Creating Functions
  
  
</h2>
    

<p>At this point, we can convert a distance from kilometres to miles by changing a value in this script, and running the script again.  If we want to make multiple conversions, we would have to copy and paste the part of the code with the <code class="language-plaintext highlighter-rouge">convertedDistance</code> variable for each conversion.  This is inconvenient.  It would also be more convenient if we could make conversions from the command line in the Lua Console, rather than changing and reloading the script.  A <em>function</em> will let us do both these things.</p>

<p>We can write a function like this:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">kilometres</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">kilometres</span><span class="o">*</span><span class="n">cmPerKm</span> <span class="c1">-- km -&gt; cm</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">inchesPerCm</span> <span class="c1">-- cm -&gt; in</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">feetPerInch</span> <span class="c1">-- in -&gt; ft</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">milesPerFoot</span> <span class="c1">-- ft -&gt; mi</span>
    <span class="k">return</span> <span class="n">convertedDistance</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Let’s break down this section of code:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span> <span class="o">=</span> 
</code></pre></div></div>
<p>This means that we are going to assign the function that we create to the global variable <code class="language-plaintext highlighter-rouge">kmToMiles</code>.  That’s right.  Lua considers a series of instructions bundled into a <em>function</em> to be a value, the same as a string or number.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="p">(</span><span class="n">kilometres</span><span class="p">)</span>
</code></pre></div></div>
<p>The special word <code class="language-plaintext highlighter-rouge">function</code> tells Lua that we want to define a function, and that the subsequent commands are a part of the function.</p>

<p>The parentheses <code class="language-plaintext highlighter-rouge">()</code> enclose the function <em>parameter</em> <code class="language-plaintext highlighter-rouge">kilometres</code>.  A function parameter is a local variable (only good within the function) whose value is unknown until the function is executed.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">local</span> <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">kilometres</span><span class="o">*</span><span class="n">cmPerKm</span> <span class="c1">-- km -&gt; cm</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">inchesPerCm</span> <span class="c1">-- cm -&gt; in</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">feetPerInch</span> <span class="c1">-- in -&gt; ft</span>
    <span class="n">convertedDistance</span> <span class="o">=</span> <span class="n">convertedDistance</span><span class="o">*</span><span class="n">milesPerFoot</span> <span class="c1">-- ft -&gt; mi</span>
</code></pre></div></div>
<p>This section contains the commands to perform in order to convert the value supplied by <code class="language-plaintext highlighter-rouge">kilometres</code> into a number representing an equivalent number of miles.  This time, <code class="language-plaintext highlighter-rouge">convertedDistance</code> is a local variable only accessible from within the defined function.</p>

<p>It is also worth noting that these lines are indented.  In Lua, this is just a convention to make code more readable.  The code would work just fine if it were not indented.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">return</span> <span class="n">convertedDistance</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">return</code> keyword tells the function to stop executing.  The value to the right of <code class="language-plaintext highlighter-rouge">return</code> (in this case, <code class="language-plaintext highlighter-rouge">convertedDistance</code>) will be supplied to the part of the program that “called” the function in the first place.  Functions do not have to return values.  For example, the function <code class="language-plaintext highlighter-rouge">print</code> that we’ve been using doesn’t return anything.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">end</span>
</code></pre></div></div>
<p>The special word <code class="language-plaintext highlighter-rouge">end</code> tells the Lua Interpreter that we have reached the end of the function, and there are no more instructions to include.  The function execution also stops here if the code has not reached a <code class="language-plaintext highlighter-rouge">return</code> line before this.</p>

<p>Now that we have a function, let’s see how we would use it to convert 12 kilometres to miles:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
</code></pre></div></div>
<p>What happens here is that the function <code class="language-plaintext highlighter-rouge">kmToMiles</code> is evaluated with value <code class="language-plaintext highlighter-rouge">12</code> as the <em>argument</em>.  <em>Argument</em> is the term used for the value that is assigned to a function parameter, in this case <code class="language-plaintext highlighter-rouge">kilometre</code>.  After <code class="language-plaintext highlighter-rouge">kmToMiles</code> performs calculations on <code class="language-plaintext highlighter-rouge">12</code>, it returns the result: <code class="language-plaintext highlighter-rouge">7.456454306848</code>.  At that point, the above line is equivalent to</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="mi">7</span><span class="p">.</span><span class="mi">456454306848</span><span class="p">)</span>
</code></pre></div></div>
<p>and at this point, the <code class="language-plaintext highlighter-rouge">print</code> function prints the answer to the console.</p>

<p>If we eliminate the redundant code, <strong>conversion.lua</strong> looks like this:</p>

<p><img src="03_lesson_images/conversion-function.png" alt="conversion.lua with function" /></p>

<p>You may notice that kmToMiles is underlined in blue.  Hover your cursor over it to see the complaint:</p>

<p><img src="03_lesson_images/lower-case-global.png" alt="lower case global" /></p>

<p>The Lua Language Server has noticed that <code class="language-plaintext highlighter-rouge">kmToMiles</code> is a global variable, and the convention that Lua Language Server follows is that global variables start with a capital letter.  I don’t follow that convention (and didn’t even know that Lua LS would note this until writing this lesson) because I only use global variables to make functionality available to the console.  The reasons why will be discussed in a <a href="lessonLinkPlaceHolder.html">future lesson</a>.</p>

<p>A light bulb appears near the “spelling mistake” and offers options:</p>

<p><img src="03_lesson_images/click-lightbulb.png" alt="click the lightbulb" /></p>

<p><img src="03_lesson_images/lower-case-global-options.png" alt="options" /></p>

<p>Clicking the first option makes VS Code accept that kmToMiles can be a global variable.</p>

<p>On the topic of spell checking, I use the Code Spell Checker extension by Street Side Software:</p>

<p><img src="03_lesson_images/spell-check-extension.png" alt="spell check extension" /></p>

<p>I will be using this spell checker in lessons from now on.</p>

<p>Now, run <strong>conversion.lua</strong> in the Console.  The result of converting 12 kilometres to miles is once again printed to the console.  However, something that isn’t immediately obvious is that you can now access <code class="language-plaintext highlighter-rouge">kmToMiles</code> from the console command line.  Type the following command to convert 20 kilometres to miles:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></div>
<p>You will find that 20 kilometres is some 12.4 miles:</p>

<p><img src="03_lesson_images/kmToMiles-console.png" alt="kmToMiles console" /></p>

<p>Now, let’s write a function to convert from miles to kilometres.  We’ve already defined the unit conversion rates.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nf">milesToKm</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">miles</span><span class="o">*</span><span class="n">feetPerMile</span><span class="o">*</span><span class="n">inchesPerFoot</span><span class="o">*</span><span class="n">cmPerInch</span><span class="o">*</span><span class="n">kmPerCm</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The first thing to note is that the line that begins the function is different from last time.</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nf">milesToKm</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
</code></pre></div></div>
<p>Is an equally valid alternative to</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">milesToKm</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
</code></pre></div></div>
<p>and is, in fact, the way that I usually define functions.  The typical exception would be when I’m defining a function that I’m not assigning to a variable because I only want to use it once.</p>

<p>The other things to note are that I perform calculations on the return line rather than specifying the value of a variable to return and that I can, in fact, perform several multiplications on the same line.</p>

<p>Add this function to your <strong>conversion.lua</strong> file, and a line to print the result of converting 7 miles to kilometres.  Run the resulting script in the console, and test out the <code class="language-plaintext highlighter-rouge">milesToKm</code> function on the command line.</p>

<p><img src="03_lesson_images/conversion-2-fn.png" alt="conversion.lua" /></p>

<p>And the result of running the script, and converting 50 miles to kilometres in the console.  (Note that the first 3 lines were there from earlier.)</p>

<p><img src="03_lesson_images/convert-2-fn-console.png" alt="conversion.lua console results" /></p>
<h2 id="invalid-value-errors">
  
  
    <a href="#invalid-value-errors">&#128279</a> Invalid Value Errors
  
  
</h2>
    

<p>When programming, sometimes we will make a mistake and cause an error.  We’ve now got enough experience to understand one of the error messages.  If you closed the game at the end of the last section, load the <strong>conversion.lua</strong> script again.</p>

<p>Now, in the command line, enter the following code</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kmToMiles</span><span class="p">(</span><span class="s2">"Twelve"</span><span class="p">)</span>
</code></pre></div></div>
<p>You will receive the following error:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; kmToMiles("Twelve")
C:\Games\Test of Time\lua\conversion.lua:11: attempt to perform arithmetic on a string value (local 'kilometres')
stack traceback:
	C:\Games\Test of Time\lua\conversion.lua:11: in function 'kmToMiles'
	(...tail calls...)
</code></pre></div></div>
<p>First, we look at this part of the error:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Games\Test of Time\lua\conversion.lua:11
</code></pre></div></div>
<p>This tells us what file the error was detected in (the path may be different for you, based on where you installed Test of Time), and the line it was detected on, line 11.  (If your <strong>conversion.lua</strong> file doesn’t match mine exactly, the line number may be different.)</p>

<p>Looking at line 11, we see:</p>

<p><img src="03_lesson_images/line-11-error.png" alt="line 11 and surroundings" /></p>

<p>Next, we look at this part of the message:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>attempt to perform arithmetic on a string value (local 'kilometres')
</code></pre></div></div>
<p>This part of the message tells us the detected problem.  We’re trying to do some form of arithmetic (in this case multiplication) on a string (<code class="language-plaintext highlighter-rouge">"twelve"</code>).  This isn’t allowed, so Lua throws an error.</p>

<p>For this part of the error</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stack traceback:
	C:\Games\Test of Time\lua\conversion.lua:11: in function 'kmToMiles'
	(...tail calls...)
</code></pre></div></div>
<p>we will re-generate the error, but inside <strong>conversion.lua</strong> by adding our bad code to line 25 (along with a print command):</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="s2">"twelve"</span><span class="p">))</span>
</code></pre></div></div>
<p>After doing this, the “stack traceback” section looks like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stack traceback:
	C:\Games\Test of Time\lua\conversion.lua:11: in function 'kmToMiles'
	C:\Games\Test of Time\lua\conversion.lua:25: in main chunk
</code></pre></div></div>
<p>Now, we have 2 places referenced.  One is line 11, where the error was detected, and the other is line 25, where we <em>called</em> <code class="language-plaintext highlighter-rouge">kmToMiles</code>.  In this example, line 11 is correct, and our mistake is on line 25.  Of course, the error handler doesn’t know where the problem is.  As far as it is concerned, <code class="language-plaintext highlighter-rouge">"twelve"</code> could be a perfectly valid argument for <code class="language-plaintext highlighter-rouge">kmToMiles</code>, so, we’re given both lines and we must sort it out for ourselves.</p>

<p>Of course, there is only so much the error generator can do for us.  Replace</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="s2">"twelve"</span><span class="p">))</span>
</code></pre></div></div>
<p>with</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">twelveVariable</span> <span class="o">=</span> <span class="s2">"twelve"</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmToMiles</span><span class="p">(</span><span class="n">twelveVariable</span><span class="p">))</span>

</code></pre></div></div>
<p>and run the script again.  The same error is generated (except that the line is different), so it is up to us to figure out why twelveVariable is a string when we were expecting it to be a number.</p>

<p>Fortunately, the Lua Language Server can detect possible errors, if we annotate our code properly.  On the line above the <code class="language-plaintext highlighter-rouge">kmToMiles</code> definition, type 3 dashes <code class="language-plaintext highlighter-rouge">---</code>, and press enter for the following suggestion:</p>

<p><img src="03_lesson_images/param-return-suggestion.png" alt="param-return suggestion" /></p>

<p>The following code is generated</p>

<p><img src="03_lesson_images/param-return-placed.png" alt="param-return" /></p>

<p>Replace <code class="language-plaintext highlighter-rouge">comment</code> with a basic description of the function, <code class="language-plaintext highlighter-rouge">any</code> with <code class="language-plaintext highlighter-rouge">number</code> and <code class="language-plaintext highlighter-rouge">unknown</code> with <code class="language-plaintext highlighter-rouge">number</code> also.</p>

<p><img src="03_lesson_images/annotated-kmToMiles.png" alt="annotated kmToMiles" /></p>

<p>With this annotation, the name <strong>conversion.lua</strong> is now yellow, and on line 29, <code class="language-plaintext highlighter-rouge">twelveVariable</code> is underlined in yellow.  The Lua Language Server has detected a possible error.  If we hover over the underlined code, we get the following explanation:</p>

<p><img src="03_lesson_images/cant-assign-string-to-number.png" alt="Cannot assign string to number" /></p>

<p>While we’re at it, we can also hover over <code class="language-plaintext highlighter-rouge">kmToMiles</code> and see the documentation that we’ve written for the function:</p>

<p><img src="03_lesson_images/kmToMiles-doc.png" alt="kmToMiles documentation" /></p>

<p>Change <code class="language-plaintext highlighter-rouge">twelveVariable</code> to <code class="language-plaintext highlighter-rouge">12</code> and the yellow will disappear.</p>

<p>This power to document code so it appears in tooltips later (and export it so I could make this website), along with the ability to detect mismatched values is why I chose VS Code with Lua Language Server as the example coding environment for these lessons.  Lua Language Server is open source, so it is available for other programming environments as well.  It should be noted that as far as the Lua Interpreter is concerned, these annotations are just comments, even if VS Code colours them differently, because they all start with <code class="language-plaintext highlighter-rouge">--</code>.</p>
<h2 id="register-an-on-turn-event">
  
  
    <a href="#register-an-on-turn-event">&#128279</a> Register an On Turn Event
  
  
</h2>
    

<p>We have now reached the point where we can write a simple event, and register it.  We will begin by creating a new file, <strong>onTurnEvent.lua</strong> in the lua folder.</p>

<p>We will use the function <a href="/auto_doc/civ.html#onturn">civ.scen.onTurn</a>, which has the following relevant documentation:</p>

<blockquote>
<h3 id="onturn">
  
  
    <a href="#onturn">&#128279</a> onTurn
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.scen.onTurn(code: fun(turn: integer))
</code></pre></div>  </div>
  <p>Registers a function that is called at the start of a turn.</p>
</blockquote>

<p>(There is some more information explaining how it relates to other events.)</p>

<p>Let’s have a look at the code block:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nc">civ</span><span class="p">.</span><span class="nf">scen</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">turn</span><span class="p">:</span> <span class="n">integer</span><span class="p">))</span>
</code></pre></div></div>
<p>This part of the documentation tells us how to use this function.  <code class="language-plaintext highlighter-rouge">function civ.scen.onTurn</code> tells us that this is a function that we can call, and that we call it by writing <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> (You may notice that <code class="language-plaintext highlighter-rouge">.</code> is not a valid character for a variable name.  This will be explained <a href="lessonLinkPlaceHolder.html">in a later lesson</a>.)</p>

<p>The part within the <code class="language-plaintext highlighter-rouge">()</code> tells us the parameter name and the kind of argument the function expects for the parameter.  <code class="language-plaintext highlighter-rouge">code</code> tells us that the function’s parameter name is “code” .  We don’t <em>need</em> the parameter name to use the function, but the parameter name can give insight into how the designer expects the function to be used.</p>

<p><code class="language-plaintext highlighter-rouge">: fun()</code> tells us that the <code class="language-plaintext highlighter-rouge">code</code> parameter expects a function as an argument.  <code class="language-plaintext highlighter-rouge">turn: integer</code> means that the function supplied should have one parameter, <code class="language-plaintext highlighter-rouge">turn</code> and that parameter should accept integer arguments.</p>

<p>At the moment, the above couple paragraphs may have been as clear as mud.  Let’s build the event, and hopefully the meaning will be more obvious.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">onTurnEvent</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>

<span class="k">end</span>
</code></pre></div></div>
<p>Here, we define a local function, which has a single parameter, called <code class="language-plaintext highlighter-rouge">turn</code>.  We will add an annotation that the parameter <code class="language-plaintext highlighter-rouge">turn</code> is an integer.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">---@param turn integer</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">onTurnEvent</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>

<span class="k">end</span>
</code></pre></div></div>
<p>Here I should note that, unlike many programming languages, Lua doesn’t distinguish between integers and numbers that can have a fractional part (often called <a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">“floats”</a> or <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">“doubles”</a>).  As far as Lua is concerned, they are both part of the same type.  However, Lua Language Server allows us to make the distinction, since many functions only accept integer arguments.</p>

<p>Our function is now technically suitable to use as an argument for <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code>, although it doesn’t do anything yet.  So, let’s add a line where we use the function with <code class="language-plaintext highlighter-rouge">onTurnEvents</code> as the argument:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">civ</span><span class="p">.</span><span class="n">scen</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="n">onTurnEvent</span><span class="p">)</span>
</code></pre></div></div>
<p>When you try to type in <code class="language-plaintext highlighter-rouge">civ.</code>, you might find that VS Code tries to autocomplete to <code class="language-plaintext highlighter-rouge">civlua.</code> and that you get a box appearing that looks like this:</p>

<p><img src="03_lesson_images/auto-require.png" alt="auto require box" /></p>

<p>Ignore the box (it will go away in a moment), and use backspace to go back to <code class="language-plaintext highlighter-rouge">civ</code>.  If pressing <code class="language-plaintext highlighter-rouge">.</code> again autocompletes, backspace back to <code class="language-plaintext highlighter-rouge">civ</code> then press Escape, which should let you press <code class="language-plaintext highlighter-rouge">.</code> and continue typing.  We got that behaviour because VS Code saw the <strong>civlua.lua</strong> file in our directory, and thought we might want to use code from that file.  The Lua Scenario Template has documentation that tells VS Code that <code class="language-plaintext highlighter-rouge">civ.</code> is a perfectly fine way to start a function, but we’re not using the template yet, so VS Code has no way to know this.</p>

<p>Thus far, our “event” looks like this:</p>

<p><img src="03_lesson_images/onTurn-empty.png" alt="basic onTurn event" /></p>

<p>In the code <code class="language-plaintext highlighter-rouge">civ</code> is underlined as a possible mistake.  When we hover the cursor over it, we get the following message:</p>

<p><img src="03_lesson_images/undefined-global-civ.png" alt="undefined global" /></p>

<p>The Lua Language Server warns us when we’re trying to use a global variable that hasn’t been specified elsewhere, since that often means we’ve made a typo or a mistake.  As I’ve said before, we’ll discuss this more in the <a href="lessonLinkPlaceHolder.html">lesson on variable scope</a>.</p>

<p>For now, click on the “Quick Fix…” option, and then select “Disable diagnostics on this line (undefined-global).”</p>

<p><img src="03_lesson_images/disable-diagnostics.png" alt="disable-diagnostic" /></p>

<p>If you know that the Lua Language Server is making a mistake flagging a particular line, this option creates an annotation that will suppress it.</p>

<p>At this point, although we have an “event,” the event doesn’t actually do anything.  We’ll gain tools over the next couple of lessons to make much more interesting events, but, for now, we will just show a text box telling the player what turn it is.</p>

<p>From the first lesson, we know that <a href="/auto_doc/civ.html#text"><code class="language-plaintext highlighter-rouge">civ.ui.text</code></a> can create text boxes.  Let’s look at the documentation:</p>

<blockquote>
<h3 id="text">
  
  
    <a href="#text">&#128279</a> text
  
  
</h3>
    
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function civ.ui.text(string: string, ...string)
</code></pre></div>  </div>
  <p>Display a pop-up text box with the given string as text.</p>

  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">string</code> — text to show in a text box</p>

  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">...</code> — more text</p>
</blockquote>

<p>The first thing that’s different about this documentation is the parameter information: <code class="language-plaintext highlighter-rouge">(string: string, ...string)</code>.  Although we haven’t written a function like that yet, functions are allowed to have more than one parameter/argument.  When they do, each parameter (or argument, when the function is called) is separated by a <code class="language-plaintext highlighter-rouge">,</code>.  This is very common, and we’ll see a lot of that in the upcoming lessons.  What is uncommon is the <code class="language-plaintext highlighter-rouge">...string</code> in place of a <code class="language-plaintext highlighter-rouge">parameterName: valueType</code>.  This means that an arbitrary number of strings can be given as additional arguments.  We won’t use that feature now.</p>

<p>The other different thing is that in this piece of documentation, there is extra information about the function parameters:</p>

<blockquote>
  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">string</code> — text to show in a text box</p>

  <p>@<em>param</em> <code class="language-plaintext highlighter-rouge">...</code> — more text</p>
</blockquote>

<p>The <code class="language-plaintext highlighter-rouge">string</code> parameter has the extra information that it is the text to show in the text box, and <code class="language-plaintext highlighter-rouge">...</code> is more text (to be shown).  Sometimes documentation is expressive, and other times it is brief, and we must experiment a bit if the documentation isn’t fully clear.</p>

<p>Since there isn’t much point in doing arithmetic on the turn number, we will settle for a simple message displaying the current turn:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"It is now turn "</span><span class="o">..</span><span class="nb">tostring</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">tostring</code> function is native to Lua and converts a value into a suitable string equivalent.  If you hover your cursor over <code class="language-plaintext highlighter-rouge">tostring</code> in VS Code, you will see the following documentation (ignore the part about “metatables,” that’s advanced stuff).</p>

<p><img src="03_lesson_images/tostring-doc.png" alt="tostring documentation" /></p>

<p>We use <code class="language-plaintext highlighter-rouge">tostring</code> in order to convert <code class="language-plaintext highlighter-rouge">turn</code>, which is a <em>number</em>, to a <em>string</em> which can be joined to other strings using <code class="language-plaintext highlighter-rouge">..</code>.</p>

<p>The Lua Language Server has once again identified <code class="language-plaintext highlighter-rouge">civ</code> as a possible problem, so have diagnostics ignore that line.  Once you’re done, <strong>onTurnEvent.lua</strong> should look like this:</p>

<p><img src="03_lesson_images/on-turn-full-event.png" alt="complete onTurn event" /></p>

<p>Save this file, and save your active Civ II game, so that you can easily reload later.</p>

<p>Open the console, and load the <strong>onTurnEvent.lua</strong> script.  The console will look the same as it did before, since we didn’t have any kind of print statement in this script.  Close the Lua Console, end your turn, and allow the AI to move.  Before you move again, you should get this event message:</p>

<p><img src="03_lesson_images/onTurn-turn-2.png" alt="on turn event" /></p>

<p>Proceed to play, and note how you get a message every turn, with a different turn number.</p>

<p>Now, load your saved game, and play a couple turns.  You will notice that the event does not happen.  Load the <strong>onTurnEvent.lua</strong> script again, verify that it is active by playing until the next turn, and then save the game.  Load this more recent saved game, and play.  You will still find that the event doesn’t happen.</p>

<p>That’s because Lua Events must be registered every time a game is loaded.  When a game is loaded, the Game will automatically check if there is an available file named <strong>events.lua</strong> in its folder, and, if so, run <strong>events.lua</strong> as a script in order to register all of the scenario’s events.  As we’ll see, <strong>events.lua</strong> doesn’t have to contain <em>all</em> the code; it can reference other files to get the necessary code.</p>

<p>When we program events for Civilization II, what we are doing is creating a giant script which defines functions like <code class="language-plaintext highlighter-rouge">onTurnEvent</code>, and then registering them with functions like <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code>.  Once these functions have been registered, a player plays the game, and, at certain <a href="/executionPoints.html">“execution points”</a> the game runs a registered function, supplying certain data.  In our <strong>onTurnEvent.lua</strong> example, at the start of every game turn (between tribe 7 and the barbarian turn), the game feeds the new game turn into the <code class="language-plaintext highlighter-rouge">onTurnEvent</code> function, which uses that information to display a text box with the current turn.</p>

<p>Let’s turn our attention back to <strong>onTurnEvent.lua</strong>.  We will create another text box event:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">aSecondEvent</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span>
<span class="c1">---@diagnostic disable-next-line: undefined-global</span>
    <span class="n">civ</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"This is a second message for turn "</span><span class="o">..</span><span class="n">turn</span><span class="o">..</span><span class="s2">"."</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">---@diagnostic disable-next-line: undefined-global</span>
<span class="n">civ</span><span class="p">.</span><span class="n">scen</span><span class="p">.</span><span class="n">onTurn</span><span class="p">(</span><span class="n">aSecondEvent</span><span class="p">)</span>
</code></pre></div></div>
<p>Before I have you add this code to <strong>onTurnEvent.lua</strong> and run the script, I should admit to telling a lie a bit earlier.  In the <code class="language-plaintext highlighter-rouge">onTurnEvent</code> function, I said that we had to use the <code class="language-plaintext highlighter-rouge">tostring</code> function to convert the value for <code class="language-plaintext highlighter-rouge">turn</code> into a string, before we concatenated it using <code class="language-plaintext highlighter-rouge">..</code>.  That is true for most data types, but the <code class="language-plaintext highlighter-rouge">..</code> operator will automatically transform numbers into strings, so we can save a bit of typing.</p>

<p>Now, add this code to <strong>onTurnEvent.lua</strong>, to get:</p>

<p><img src="03_lesson_images/on-turn-two-events-attempt.png" alt="two on turn events attempt" /></p>

<p>Load this script, and play until the next turn.  You will find that only the second message box appears.  Why is that?  Well, that is because the second call to <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> <em>replaced</em> <code class="language-plaintext highlighter-rouge">onTurnEvent</code> with <code class="language-plaintext highlighter-rouge">aSecondEvent</code>, rather than registering <code class="language-plaintext highlighter-rouge">aSecondEvent</code> <em>in addition to</em> <code class="language-plaintext highlighter-rouge">onTurnEvent</code>.  The Lua Scenario Template provides a function <code class="language-plaintext highlighter-rouge">discreteEvents.onTurn</code> which allows you to register onTurn events in discrete blocks, and hides away the call to <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> in a file that a scenario designer is not expected to change.</p>

<p>However, we don’t have access to <code class="language-plaintext highlighter-rouge">discreteEvents.onTurn</code> just yet, so let’s continue using <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code>.  Since we can’t register two functions, we must combine both of the effects into a single function, and only register that one.  This is the result:</p>

<p><img src="03_lesson_images/correct-on-turn-2.png" alt="two message onTurn event" /></p>

<p>Load this script, and get two messages for the onTurn event.</p>
<h2 id="parameter-and-variable-names">
  
  
    <a href="#parameter-and-variable-names">&#128279</a> Parameter and Variable Names
  
  
</h2>
    

<p>In the last section, we chose to call the parameter for <code class="language-plaintext highlighter-rouge">onTurnEvent</code> <code class="language-plaintext highlighter-rouge">turn</code> because the documentation said that <code class="language-plaintext highlighter-rouge">civ.scen.onTurn</code> expected a function with a parameter named <code class="language-plaintext highlighter-rouge">turn</code>.  This wasn’t necessary.  “Turn” is how we should interpret the argument passed to <code class="language-plaintext highlighter-rouge">onTurnEvent</code>, but we could name the parameter whatever we wanted.</p>

<p>Let’s try that now.  Move the cursor to one of the <code class="language-plaintext highlighter-rouge">turn</code> variable references, and right click.</p>

<p><img src="03_lesson_images/turn-right-click.png" alt="turn right click" /></p>

<p>Select “Rename Symbol”, and change the name from “turn” to “money”.</p>

<p><img src="03_lesson_images/turn-to-money.png" alt="turn to money" /></p>

<p>Save the script, and run it again.  Even though the onTurn event has nothing to do with money, the event works just fine.</p>

<p>This arbitrary choice of name extends to variable names as well.  Let’s take another look at <strong>conversion.lua</strong>:</p>

<p><img src="03_lesson_images/conversion-lua-again.png" alt="conversion.lua again" /></p>

<p>We can, for example, rename the variable <code class="language-plaintext highlighter-rouge">inchesPerFoot</code> to <code class="language-plaintext highlighter-rouge">inchesPerFurlong</code> (without changing its value), and our program will work just as well as before.  Parameter and variable names are chosen for human convenience.  The Lua Interpreter doesn’t care what they are, as long as they don’t conflict with special words or other assigned variable names.  For example, if we changed the parameter name of <code class="language-plaintext highlighter-rouge">kmToMiles</code> from <code class="language-plaintext highlighter-rouge">kilometres</code> to <code class="language-plaintext highlighter-rouge">cmPerKm</code>, that would break the code.  That’s because the Lua interpreter wouldn’t know that only <em>one</em> of the <code class="language-plaintext highlighter-rouge">cmPerKm</code> variables referred to the function parameter, while the <em>other</em> referred to a variable defined outside the function.</p>
<h2 id="conclusion">
  
  
    <a href="#conclusion">&#128279</a> Conclusion
  
  
</h2>
    

<p>In this lesson, we’ve learned how to create variables, in order to use data later, and how to write functions, so that we can easily repeat entire sets of instructions.  We’ve also learned about the <em>string</em> and <em>number</em> data types, and registered a function to create an in game event.</p>

<p>In the next lesson, we will use the Lua Scenario Template and write some events for the “Rome” scenario that came with the original Civilization II game.  In doing so, we will learn about more data types and how to make functions that choose whether or not to execute instructions based on the values of the arguments they are supplied.</p>

<table>
  <tbody>
    <tr>
      <td>Previous: <a href="02_writingScripts.html">Writing Programs</a></td>
      <td>Next: <a href="04_civObjectsAndIfStatements.html">Civilization II Objects and If Statements</a></td>
    </tr>
  </tbody>
</table>
 -->
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
<!--        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
-->
<!--
-->
      </div>
      <div class="footer-col">
        <p>Reference materials and lessons for using Lua to program events for Civilization II: Test of Time</p>
      </div>
    </div>

    <div class="social-links">
<ul class="social-media-list">
  <li><a rel="me" href="https://github.com/ProfGarfield" target="_blank" title="ProfGarfield"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg>ProfGarfield</a></li>
  <li><a rel="me" href="https://www.youtube.com/user/ProfCiv2" target="_blank" title="YouTube"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#youtube"></use></svg>ProfCiv2</a></li>
  <li><a rel="me" href="https://forums.civfanatics.com/members/prof-garfield.43783/" target="_blank" title="Civfanatics Profile"><img src="/assets/civfanatics_icon.png" class="svg-icon grey"></img>Prof. Garfield</a></li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
